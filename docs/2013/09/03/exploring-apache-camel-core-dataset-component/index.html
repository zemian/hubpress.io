<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Exploring Apache Camel Core - DataSet Component &middot; Zemian's Blog
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/2013/09/03/exploring-apache-camel-core-dataset-component/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Exploring Apache Camel Core - DataSet Component</h1>
  <span class="post-date">03 Sep 2013</span>
  <p>A good sample data generator can help you test program more throughly and help measure
the processing throughput. The <code class="language-plaintext highlighter-rouge">camel-core</code> comes with a <code class="language-plaintext highlighter-rouge">dataset</code> component that can
help you do this easily. All you need is to provide a bean that implements
<code class="language-plaintext highlighter-rouge">org.apache.camel.component.dataset.DataSet</code> interface and bind it in
CamelContext registry. Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package camelcoredemo;

import org.slf4j.*;
import org.apache.camel.*;
import org.apache.camel.builder.*;
import org.apache.camel.main.Main;
import org.apache.camel.component.dataset.*;

public class DataSetDemoCamel extends Main {
    static Logger LOG = LoggerFactory.getLogger(DataSetDemoCamel.class);
    public static void main(String[] args) throws Exception {
        DataSetDemoCamel main = new DataSetDemoCamel();
        main.enableHangupSupport();
        main.addRouteBuilder(createRouteBuilder());
        main.bind("sampleGenerator", createDataSet());
        main.run(args);
    }
    static RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from("dataset://sampleGenerator")
                .to("log://demo");
            }
        };
    }
    static DataSet createDataSet() {
        return new SimpleDataSet();
    }
}
</code></pre></div></div>

<p>Compile and run it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile exec:java -Dexec.mainClass=camelcoredemo.DataSetDemoCamel
</code></pre></div></div>

<p>In here we have used the built-in <code class="language-plaintext highlighter-rouge">org.apache.camel.component.dataset.SimpleDataSet</code>
implementation, which by default will generate 10 messages with a text body set
to <code class="language-plaintext highlighter-rouge">&lt;hello&gt;world!&lt;/hello&gt;</code>. You may easily change the value, or even provide your own
implementation starting with <code class="language-plaintext highlighter-rouge">org.apache.camel.component.dataset.DataSetSupport</code> base
class to customize your data set.</p>

<h2 id="use-dataset-component-to-measure-throughput">Use DataSet Component to measure throughput</h2>

<p>One useful feature of <code class="language-plaintext highlighter-rouge">dataset</code> component I found is using it to load test your <code class="language-plaintext highlighter-rouge">Route</code>.
To do this, you have to adjust couple settings though. Letâ€™s say if I want to load
a large text file as sample input data and feed it to the <code class="language-plaintext highlighter-rouge">Route</code>, and then measure its
throughout.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    static RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from("dataset://sampleGenerator?produceDelay=0")
                .to("log://demo?groupSize=100");
            }
        };
    }
    static DataSet createDataSet() {
        SimpleDataSet result = new SimpleDataSet();
        result.setSize(500);
        result.setDefaultBody(readFileToString("my-large-sample.txt");
        return result;
    }
</code></pre></div></div>

<p>Replace above in the <code class="language-plaintext highlighter-rouge">Main</code> class and you will notice that it will pump 500 messages
into the <code class="language-plaintext highlighter-rouge">Route</code>, and it samples every 100 messages and display its throught rates. I
have to add <code class="language-plaintext highlighter-rouge">produceDelay=0</code> option so the generator so it will not pause between messages.
Then I have added <code class="language-plaintext highlighter-rouge">groupSize=100</code> option to <code class="language-plaintext highlighter-rouge">log</code> component for throughput measurement.
I skipped <code class="language-plaintext highlighter-rouge">readFileToString(String)</code> demo code since I assume you can easily figured that
out on your own. (Hint: checkout Apache <code class="language-plaintext highlighter-rouge">commons-io</code> library.)</p>

<p>There is another side of <code class="language-plaintext highlighter-rouge">dataset</code> component that you may use, and that is to receive and
verify message content. You would simply use the same URL in a
<code class="language-plaintext highlighter-rouge">to(url)</code> line. Internally Camel would assert your message body against your original.</p>

<p>There are more options availabe from <a href="http://camel.apache.org/dataset.html">DataSet</a> component
that you may explore.
<a href="http://saltnlight5.blogspot.com/2013/08/getting-started-with-apache-camel-using.html">Try it out with a Route</a>
and see it for yourself.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/20/world-of-php/">
            The World of PHP Development
            <small>20 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/19/multiple-jquery/">
            How to Load Multiple jQuery
            <small>19 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/15/switched-to-vuepress/">
            Switched Blogging to VuePress
            <small>15 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
