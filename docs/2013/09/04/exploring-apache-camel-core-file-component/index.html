<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Exploring Apache Camel Core - File Component &middot; Zemian's Blog
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/2013/09/04/exploring-apache-camel-core-file-component/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Exploring Apache Camel Core - File Component</h1>
  <span class="post-date">04 Sep 2013</span>
  <p>A file poller is a very useful mechanism to solve common IT problems. Camel’s built-in <code class="language-plaintext highlighter-rouge">file</code> component is extremely flexible, and there are many options available for configuration. Let’s cover few common usages here.</p>

<h2 id="polling-a-directory-for-input-files">Polling a directory for input files</h2>

<p>Here is a typical Camel <code class="language-plaintext highlighter-rouge">Route</code> used to poll a directory for input files on every second.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import org.slf4j.*;
import org.apache.camel.*;
import org.apache.camel.builder.*;
import java.io.*;

public class FileRouteBuilder extends RouteBuilder {
    static Logger LOG = LoggerFactory.getLogger(FileRouteBuilder.class);
    public void configure() {
        from("file://target/input?delay=1000")
        .process(new Processor() {
            public void process(Exchange msg) {
                File file = msg.getIn().getBody(File.class);
                LOG.info("Processing file: " + file);
            }
        });
    }
}
</code></pre></div></div>

<p>Run this with following</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile exec:java -Dexec.mainClass=org.apache.camel.main.Main -Dexec.args='-r camelcoredemo.FileRouteBuilder'
</code></pre></div></div>

<p>The program will begin to poll your <code class="language-plaintext highlighter-rouge">target/input</code> folder under your current directory, and wait for incoming files. To test with input files, you would need to open another terminal, and then create some files as follow.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo 'Hello 1' &gt; target/input/test1.txt
echo 'Hello 2' &gt; target/input/test2.txt
</code></pre></div></div>

<p>You should now see the first prompt window start to picking up the files and pass to the next <code class="language-plaintext highlighter-rouge">Processor</code> step. In the <code class="language-plaintext highlighter-rouge">Processor</code>, we obtain the <code class="language-plaintext highlighter-rouge">File</code> object from the message body. It then simply logs it’s file name. You may hit <code class="language-plaintext highlighter-rouge">CTRL+C</code> when you are done.</p>

<p>There many configurable options from <code class="language-plaintext highlighter-rouge">file</code> componet you may use in the URL, but most of the default settings are enough to get you going as simple case above. Some of these default behavior is such that if the input folder doesn’t exists, it will create it. And when the file is done processing by the <code class="language-plaintext highlighter-rouge">Route</code>, it will be moved into a <code class="language-plaintext highlighter-rouge">.camel</code> folder. If you don’t want the file at all after processing, then set <code class="language-plaintext highlighter-rouge">delete=true</code> in the URL.</p>

<h2 id="read-in-the-file-content-and-converting-to-different-types">Read in the file content and converting to different types</h2>

<p>By default, the <code class="language-plaintext highlighter-rouge">file</code> component will create a <code class="language-plaintext highlighter-rouge">org.apache.camel.component.file.GenericFile</code> object for each file found and pass it down your <code class="language-plaintext highlighter-rouge">Route</code> as message body. You may retrieve all your file information through this object. Or alternatively, you may also use the <code class="language-plaintext highlighter-rouge">Exchange</code> API to auto convert the message body object to a type you expect to receive (eg: as with <code class="language-plaintext highlighter-rouge">msg.getIn().getBody(File.class)</code>). In above example, the <code class="language-plaintext highlighter-rouge">File</code> is a type you expect to get from the message body, and Camel hence will try to convert it for you. The Camel uses the context’s registry space to pre-registered many <code class="language-plaintext highlighter-rouge">TypeConverter</code>’s that can handle most of the common data types (like Java primative etc) conversion. These <code class="language-plaintext highlighter-rouge">TypeConverter</code><em>s</em> are powerful way to make your <code class="language-plaintext highlighter-rouge">Route</code> and <code class="language-plaintext highlighter-rouge">Processor</code> more flexbile and portable.</p>

<p>Camel will not only convert just your <code class="language-plaintext highlighter-rouge">File</code> object from message body, but it can also read the file content. If your files are character text based, then you can simply do this.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        from("file://target/input?charset=UTF-8")
        .process(new Processor() {
            public void process(Exchange msg) {
                String text = msg.getIn().getBody(String.class);
                LOG.info("Processing text: " + text);
            }
        });
</code></pre></div></div>

<p>That’s it! Simply specify <code class="language-plaintext highlighter-rouge">String</code> type, and Camel will read your file in and pass the entire file text content as body message. You may even use the <code class="language-plaintext highlighter-rouge">charset</code> to change the encoding.</p>

<p>If you are dealing with binary file, then simply try <code class="language-plaintext highlighter-rouge">byte[] bytes = msg.getIn().getBody(byte[].class);</code> conversion instead. Pretty cool huh?</p>

<h2 id="polling-and-processing-large-files">Polling and processing large files</h2>

<p>When working with large files, there few options in <code class="language-plaintext highlighter-rouge">file</code> componet that you might want to use to ensure proper handling. For example, you might want to move the input file into a <code class="language-plaintext highlighter-rouge">staging</code> folder before the <code class="language-plaintext highlighter-rouge">Route</code> starts the processing; and when it’s done, move it to a <code class="language-plaintext highlighter-rouge">.completed</code> folder.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        from("file://target/input?preMove=staging&amp;move=.completed")
        .process(new Processor() {
            public void process(Exchange msg) {
                File file = msg.getIn().getBody(File.class);
                LOG.info("Processing file: " + file);
            }
        });
</code></pre></div></div>

<p>To feed input files properly into the polling folder, it’s best if the sender generates the input files in a temporary folder first, and only when it’s ready then move it into the polling folder. This will minimize reading an incomplete file by the <code class="language-plaintext highlighter-rouge">Route</code> if the input file might take times to generate. Also another solution to this is to config <code class="language-plaintext highlighter-rouge">file</code> endpoint to only read the polling folder when there is a signal or ready marker file exists. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        from("file://target/input?preMove=staging&amp;move=.completed&amp;doneFileName=ReadyFile.txt")
        .process(new Processor() {
            public void process(Exchange msg) {
                File file = msg.getIn().getBody(File.class);
                LOG.info("Processing file: " + file);
            }
        });
</code></pre></div></div>

<p>Above will only read the <code class="language-plaintext highlighter-rouge">target/input</code> folder when there is a <code class="language-plaintext highlighter-rouge">ReadyFile.txt</code> file exists. The marker file can be just an empty file, and it will be removed by Camel after polling. This solution would allow the sender to generate input files in however long time it might take.</p>

<p>Another concern with large file processing is to avoid loading entire file content into memory for processing. To be more practical, you want to split the file into records (eg: per line) and process it one by one (or called “streaming”). Here is how you would do that using Camel.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        from("file://target/input?preMove=staging&amp;move=.completed")
        .split(body().tokenize("\n"))
        .streaming()
        .process(new Processor() {
            public void process(Exchange msg) {
                String line = msg.getIn().getBody(String.class);
                LOG.info("Processing line: " + line);
            }
        });
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">Route</code> will allow you to process large size file without cosuming too much memory and process it line by line very efficiently.</p>

<h2 id="writing-messages-back-into-file">Writing messages back into file</h2>

<p>The <code class="language-plaintext highlighter-rouge">file</code> component can also be used to write messages into files. Recall that we may use <code class="language-plaintext highlighter-rouge">dataset</code> component to generate sample messages. We will use that to feed the <code class="language-plaintext highlighter-rouge">Route</code> and send to the <code class="language-plaintext highlighter-rouge">file</code> component so you can see that each message generated will be saved into a file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package camelcoredemo;

import org.slf4j.*;
import org.apache.camel.*;
import org.apache.camel.builder.*;
import org.apache.camel.main.Main;
import org.apache.camel.component.dataset.*;

public class FileDemoCamel extends Main {
    static Logger LOG = LoggerFactory.getLogger(FileDemoCamel.class);
    public static void main(String[] args) throws Exception {
        FileDemoCamel main = new FileDemoCamel();
        main.enableHangupSupport();
        main.addRouteBuilder(createRouteBuilder());
        main.bind("sampleGenerator", createDataSet());
        main.run(args);
    }
    static RouteBuilder createRouteBuilder() {
        return new RouteBuilder() {
            public void configure() {
                from("dataset://sampleGenerator")
                .to("file://target/output");
            }
        };
    }
    static DataSet createDataSet() {
        return new SimpleDataSet();
    }
}
</code></pre></div></div>

<p>Compile and run it</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn compile exec:java -Dexec.mainClass=camelcoredemo.FileDemoCamel
</code></pre></div></div>

<p>Upon complete you will see that 10 files would be generated in <code class="language-plaintext highlighter-rouge">target/output</code> folder with
file name in <code class="language-plaintext highlighter-rouge">ID-&lt;hostname&gt;-&lt;unique-number&gt;-&lt;msg-seq-num&gt;</code> format.</p>

<p>There are more options availabe from <a href="http://camel.apache.org/file2.html">File</a> component
that you may explore.
<a href="http://saltnlight5.blogspot.com/2013/08/getting-started-with-apache-camel-using.html">Try it out with a Route</a>
and see it for yourself.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/20/world-of-php/">
            The World of PHP Development
            <small>20 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/19/multiple-jquery/">
            How to Load Multiple jQuery
            <small>19 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/15/switched-to-vuepress/">
            Switched Blogging to VuePress
            <small>15 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
