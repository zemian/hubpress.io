<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      A simple way to setup Java application with external configuration file &middot; Zemian's Blog
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/2012/10/27/a-simple-way-to-setup-java-application-with-external-configuration-file/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">A simple way to setup Java application with external configuration file</h1>
  <span class="post-date">27 Oct 2012</span>
  <p>Many Java applications would deploy and run it with some kind of external configuration files. It’s very typical that you would want a set of config files per environments such as DEV, QA and PROD. There many options in tackling this problem, especially in a Java app, but keeping it simple and easy to maintain would take some disciplines.</p>

<p>Here I would layout a simple way you may use to depploy a typical Java application. The concept is simple and you can easily apply to a standalone, web, or even a JEE application.</p>

<h2 id="use-a-env-system-properties-per-environment">Use a env System Properties per environment</h2>

<p>Java allows you to invoke any program with extra System Properties added. When launching an Java application, you should set an <code class="language-plaintext highlighter-rouge">env</code> property. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash&gt; java -Denv=prod myapp.Main
</code></pre></div></div>

<p>This property would give your <code class="language-plaintext highlighter-rouge">Main</code> application to identify which environment you are running against with. You should be reading it like this inside your code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>String env = System.getProperty("env", "dev");
</code></pre></div></div>

<p>This way you always would have an environment to work with. Even if user doesn’t supply one, it will default to use <code class="language-plaintext highlighter-rouge">dev</code> env.</p>

<p>Another useful System Property to set is <code class="language-plaintext highlighter-rouge">app.home</code>. You want to set this value in relative to where your application is deployed, so you may reference any files (eg: data) easily. To do this, you can use a script wrapper to automatically calculate the path. See section below for an example.</p>

<h2 id="use-a-config-dir-prefix-in-classpath">Use a config dir prefix in CLASSPATH</h2>

<p>In stead of passing a explicit config file to your application as argument, another flexible way to load configuration file is to add an extra <code class="language-plaintext highlighter-rouge">config</code>
folder into your CLASSPATH. For example, you can easily create a startup wrapper script <code class="language-plaintext highlighter-rouge">myapp.sh</code> like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#/usr/bin/env bash
APP_HOME=$(cd "`dirname $0`/.." &amp;&amp; pwd)
java $JAVA_OPTS -Dapp.home=$APP_HOME -cp "$APP_HOME/config:$APP_HOME/lib/*" myapp.Main "$@"
</code></pre></div></div>

<p>From this, you can setup the application packaging layout this way:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    myapp
        +- bin
            +- myapp.sh
        +- config
            +- dev.properties
            +- qa.properties
            +- prod.properties
        +- data
            +- myrecords.data
        +- lib
            +- myapp-1.0.0.jar
            +- slf4j-1.7.1.jar
</code></pre></div></div>

<p>You would typically invoke the application like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash&gt; JAVA_OPTS='-Denv=prod' myapp/bin/myapp.sh
</code></pre></div></div>

<p>The above will give you a good foundation to load a single config properties file per <code class="language-plaintext highlighter-rouge">env</code>. For example, you can read your properites file like this somewhere in your code.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // Get appHome and data dir.
    String appHome = System.getProperty("app.home");
    String dataDir = appHome + "/data";
    
    // Get env value to load config parameters
    String env = System.getProperty("env", "dev");
    String config = env + ".properites";
    Properties configProps = new Properties();
    InputStream inStream = null;
    try {
        inStream = getClass().getClassLoader().getResourceAsStream(config);
        configProps.load(inStream);
    } finally {
        if (inStream != null)
            inStream.close();
    }
    // Now load any config parameters from configProps map.
</code></pre></div></div>

<p>Now you would have the <code class="language-plaintext highlighter-rouge">configProps</code> object at your disposal to read any configuration keys and values set per an environment.</p>

<p>NOTE: If you want a more flexible Java wrapper script, see my old post on <a href="http://saltnlight5.blogspot.com/2012/08/a-better-java-shell-script-wrapper.html">run-java</a> wrapper.</p>

<h2 id="do-not-abuse-classpath">Do not abuse CLASSPATH</h2>

<p>Now, just because you have setup <code class="language-plaintext highlighter-rouge">config</code> as part of your CLASSPATH entry, I have to caution you not to abuse it. What I mean is do not go wild on 
loading all your application resources in that folder! If you have that many resources that user MUST edit and configure, then you should re-think
about your application design! Simple interface, or configuration in this case, is always a win. Do not bother users with complexity just because 
your application can support gazillion ways of configuration combination. If you can keep it as one config file, it would make users very happy.</p>

<p>Also, this doesn’t mean you have to put the entire world inside one of <code class="language-plaintext highlighter-rouge">prod.properites</code> either. In the real world, an application is likely going to have only 
handful of user tunable parameters, and many other resources are less frequent used. I would recommand put the most frequently used parameters in these
config properties only. For all other (for example most of the Spring context files in an application do not belong to a typical users config level, they are more developer level config files. In another word, changing these files would have catastrophic effect to your application!) You should put these inside as part of your <code class="language-plaintext highlighter-rouge">myapp.jar</code>.</p>

<p>You might ask, ‘Oh, but what happen if I must want to override one of 
the resource in the jar?’. But in that very unusual case, you would still have an option to override! You have the <code class="language-plaintext highlighter-rouge">config</code> as prefix in CLASSPATH, remember? Even when you nested resources inside a package inside the 
jar, you would still able to overwrite by simply create same directory structure inside <code class="language-plaintext highlighter-rouge">config</code>. You probably only do this for emmergency and less frequent use anyway.</p>

<h2 id="feedback">Feedback</h2>

<p>So what are some clever ways you have seen or done with your application configuration? I hope to hear from you and share.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/20/world-of-php/">
            The World of PHP Development
            <small>20 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/19/multiple-jquery/">
            How to Load Multiple jQuery
            <small>19 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/15/switched-to-vuepress/">
            Switched Blogging to VuePress
            <small>15 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
