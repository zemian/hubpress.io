<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      A better java shell script wrapper &middot; Zemian's Blog
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/2012/08/01/a-better-java-shell-script-wrapper/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">A better java shell script wrapper</h1>
  <span class="post-date">01 Aug 2012</span>
  <p>In many Java projects, you often see wrapper shell script to invoke the <code class="language-plaintext highlighter-rouge">java</code> command with its custom application parameters. For example, <code class="language-plaintext highlighter-rouge">$ANT_HOME/bin/ant</code>, <code class="language-plaintext highlighter-rouge">$GROOVY_HOME/bin/groovy</code>, or even in our <a href="http://bitbucket.org/timemachine/scheduler">TimeMachine Scheduler</a> you will see <code class="language-plaintext highlighter-rouge">$TIMEMACHINE_HOME/bin/scheduler.sh</code>.</p>

<p>Writing these wrapper script is boring and error prone. Most of the problems come from setting the correct classpath for the application. If you’re working on an in-house project for a company, then you can get away with hardcoding paths and your environment vars. But for open source projects, folks have to make the wrapper more flexible and generic. Most of them even provide a <code class="language-plaintext highlighter-rouge">.bat</code> version of it. Windows DOS is really a brutal and limited terminal to script away your project need. For this reason, I often encourage others to use Cygwin as much as they can. It at least has a real bash shell to work with. Another common problem with these wrappers is it can quickly get out of hand and have too many duplication of similar scripts liter every where in your project.</p>

<p>In this post, I will show you a Java wrapper script that I’ve written. It’s simple to use and very flexible for running just about any Java program. Let’s see how it’s used first, and then I will print its content at the bottom of the post.</p>

<h2 id="introducing-the-run-java-wrapper-script">Introducing the <code class="language-plaintext highlighter-rouge">run-java</code> wrapper script</h2>

<p>If you take a look at <code class="language-plaintext highlighter-rouge">$TIMEMACHINE_HOME/bin/scheduler.sh</code>, you will see that it in turns calls a <code class="language-plaintext highlighter-rouge">run-java</code> script that comes in the same directory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DIR=$(dirname $0)
SCHEDULER_HOME=$DIR/..
$DIR/run-java -Dscheduler.home="$SCHEDULER_HOME" timemachine.scheduler.tool.SchedulerServer "$@"
</code></pre></div></div>

<p>As you can see, our <code class="language-plaintext highlighter-rouge">run-java</code> can take <code class="language-plaintext highlighter-rouge">-D</code> options. Not only this, it can also take <code class="language-plaintext highlighter-rouge">-cp</code> option as well! What’s more is that you can specify these options even <strong>after</strong> the main class! This makes the <code class="language-plaintext highlighter-rouge">run-java</code> re-wrappable by other script, and still be able to add additional system properties and classpath.</p>

<p>For examples, the TimeMachine comes with Groovy library, so instead of downloading it’s full distribution again, you can simply invoke the groovy like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$TIMEMACHINE_HOME/bin/run-java groovy.ui.GroovyMain test.groovy
</code></pre></div></div>

<p>You can use <code class="language-plaintext highlighter-rouge">run-java</code> in any directory you’re in, so it’s convenient. It will resolve it’s own directory and load any jars in the <code class="language-plaintext highlighter-rouge">lib</code> directory automatically. Now if you want Groovy to run with more additional jars, you can use the <code class="language-plaintext highlighter-rouge">-cp</code> option like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$TIMEMACHINE_HOME/bin/run-java -cp "$HOME/apps/my-app/lib/*" groovy.ui.GroovyMain test.groovy
</code></pre></div></div>

<p>Often times things will go wrong if you are not careful with Java classpath, but with <code class="language-plaintext highlighter-rouge">run-java</code> script you can perform a dry run first:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RUN_JAVA_DRY=1 $TIMEMACHINE_HOME/bin/run-java -cp "$HOME/apps/my-app/lib/*" groovy.ui.GroovyMain test.groovy
</code></pre></div></div>

<p>You would run the above all in single line on a command prompt. It should print out your full java command with all options and arguments for you to inspect.</p>

<p>There are many more options to the script, which you can find out more by reading the comments in it. The current script will work on any Linux bash or on a Windows Cygwin terminal.</p>

<h2 id="using-run-java-during-development-with-maven">Using <code class="language-plaintext highlighter-rouge">run-java</code> during development with Maven</h2>

<p>Above examples are assuming you are in a released project structure such as this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $TIMEMACHINE_HOME
      +- bin/run-java
      +- lib/*.jar
</code></pre></div></div>

<p>But what about during development? A frequent use case is that you want to be able to run your latest compiled classes under <code class="language-plaintext highlighter-rouge">target/classes</code> without have to package up or release the entire project. You can use our <code class="language-plaintext highlighter-rouge">run-java</code> in these scenario as well. First, simply add <code class="language-plaintext highlighter-rouge">bin/run-java</code> in your project, then you run <code class="language-plaintext highlighter-rouge">mvn compile dependency:copy-dependencies</code> that will generate all the <code class="language-plaintext highlighter-rouge">jar</code> files into <code class="language-plaintext highlighter-rouge">target/dependency</code>. That’s all. The <code class="language-plaintext highlighter-rouge">run-java</code> will automatically detect these directories and create the correct classpath to run your main class.</p>

<p>If you use Eclipse IDE for development, then your <code class="language-plaintext highlighter-rouge">target/classes</code> will be always up-to-date, and the <code class="language-plaintext highlighter-rouge">run-java</code> can be a great gem to have in your project even for development.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/09/20/world-of-php/">
            The World of PHP Development
            <small>20 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/09/19/multiple-jquery/">
            How to Load Multiple jQuery
            <small>19 Sep 2020</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/08/15/switched-to-vuepress/">
            Switched Blogging to VuePress
            <small>15 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
