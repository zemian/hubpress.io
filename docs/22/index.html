<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Zemian's Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
	
	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/index.html">Zemian's Blog</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../archive.html">Archive</a></li>
            <li><a href="..//tags">Tags</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
  			<a href="blog/2012/12/cygwin-tips-open-anything-with-cygstart.html"><h1>Cygwin tips: open anything with cygstart</h1></a>
  			<p>13 December 2012, tags: 
			    <a href="../tags/cygwin.html">cygwin</a> 
  			</p>
  			<p><p>Cygwin has this cool command called <code>cygstart</code>, and I usually alias it as <code>open</code>.</p>
<pre><code>alias open='cygstart'
</code></pre>
<p>Here are few things I use often:</p>
<pre><code># bring up Windows Explore with folder open
bash&gt; open /cygdrive/c/temp
bash&gt; open &quot;$USERPROFILE&quot;
 
# bring up browser on a url
bash&gt; open http://google.com
 
# bring up any windows program by file extension
bash&gt; open /cygdrive/c/my.docx
</code></pre>
<p>Because I use a Cygwin terminal shell a lot, I have many alias shortcuts to many different directories. The <code>open .</code> allows me to jump to any directory and starts the Windows Explore with that directory expanded quickly. You can see more options with <code>open --help</code>.</p>
</p>
  			<a href="blog/2012/12/a-command-to-remove-all-windows-mapped-drives.html"><h1>A command to remove all Windows mapped drives</h1></a>
  			<p>12 December 2012, tags: 
			    <a href="../tags/cmd.html">cmd</a> 
  			</p>
  			<p><p>If you work in a Corp env and having a Laptop, you will likely go home<br />
with it still running and it must has all the network drives still<br />
mapped. And then later when you are at home and try to use your Laptop,<br />
you will see considerable delay. The Windows Explore and many Windows<br />
application that access File Browser dialog will try relentlessly in<br />
reconnecting those drives without sucess. This also affect your Cygwin<br />
shell too.</p>
<p>Here is a DOS command to remove them all.</p>
<pre><code>C:&gt; net use * /delete /y
</code></pre>
<p>If you are in Cygwin bash, then you must quote the <code>'*'</code>.</p>
</p>
  			<a href="blog/2012/12/intellij-idea-is-pretty-awesome.html"><h1>Intellij IDEA is pretty awesome!</h1></a>
  			<p>11 December 2012, tags: 
			    <a href="../tags/intellij.html">intellij</a> 
  			</p>
  			<p><p>Did you know IntelliJ IDEA has a free Community Edition you may <a href="http://www.jetbrains.com/idea/download/index.html">download</a>? I've been test driving it, and I will post few things I learned so far.</p>
<p>Here are few things that I usually change from out of the default installed settings.</p>
<ol>
<li>File &gt; Settings &gt; Editor =&gt; Uncheck &quot;Allow placement of caret after end of line&quot; -- This is the most annoying thing for me in IDE. It's just not for me.</li>
<li>File &gt; Settings &gt; Editor &gt; Appearance =&gt; Check &quot;Show line numbers&quot; -- I tend to relate errors and navigate content better with line number displayed.</li>
<li>File &gt; Settings &gt; Appearance &gt; Theme =&gt; Select &quot;Darcula&quot; -- This is latest version 12.0 feature. Dark screen is pretty eye pleasing compare to WHITE.</li>
<li>File &gt; Settings &gt; Compiler =&gt; Check &quot;Make project automatically&quot; -- Another new 12.0 feature that would perform incremental compile.</li>
</ol>
<p>Now the IDE is ready for me to work on any Java projects. If you work with Maven, then you will be happy to know that IDEA supports it out of box. You can get an existing project started with following steps:</p>
<ol>
<li>
<p>File &gt; Import Project =&gt; Browse to your project pom.xml. Even if you have multi Maven modules, you only need to pick the top level pom.xml and it will generate the multi IDEA modules for you automatically. Then click &quot;Ok&quot; button.</p>
</li>
<li>
<p>In &quot;Import project from external model&quot; select &quot;Maven&quot;, and then &quot;Next&quot;.</p>
</li>
<li>You can accept all default settings on this prompt, and simply go &quot;Next&quot;</li>
<li>Check all maven project to import</li>
<li>Next screen is selecting a SDK for this project (meaning pick a JDK) to use. If this is your first time setup, then create a new one by click on the Grean plus icon, then browse to your JAVA_HOME directory and click OK. Click &quot;Next&quot; to go next step.</li>
<li>
<p>Simply click &quot;Next&quot; to accept default project name. Then you are at last prompt. Simply click &quot;Finish&quot; button and you should have your project ready to go.</p>
</li>
</ol>
<p>It might seems like a lot of steps to import a project, but IDEA is really nice. After your project has completely imported and compiled, you should able open any of your Java class (use CTRL+N) that has <code>main</code> method or any JUnit classes. Right click the content editor and select &quot;Run ...&quot; to execute it (or CTRL+SHIFT+F10 to run any single unit test method).</p>
<p>I have tried a decent size Java projects (few thousand source files) and it handles it very gracefully. The UI such as Menu items, Control buttons and tool bars are very user friendly and intuitive to use. Also, right click on most places should give you a &quot;Context&quot; menu with related options. Like any IDE, it supports the CTRL+Space that auto complete code as you type. There is the ALT+ENTER would suggest hints on how to fix things when you got an error with red squiggle line. Pressing CTRL+B will jump into methods or variable declarations.</p>
<p>Another tips I have for you is the IDEA uses many icon symbols to represent many things. These give you quick visual status on files, progress and states of your Classes etc. It's helpful to see what they mean using this <a href="http://www.jetbrains.com/idea/webhelp/symbols.html">http://www.jetbrains.com/idea/webhelp/symbols.html</a></p>
<p>So overall, I think IntelliJ IDEA is pretty good and awesome in many way.</p>
</p>
  			<a href="blog/2012/11/a-very-light-groovy-based-web-application-project-template.html"><h1>A very light Groovy based web application project template</h1></a>
  			<p>28 November 2012, tags: 
			    <a href="../tags/groovy.html">groovy</a> 
  			</p>
  			<p><p>You might have heard of the project Grails is a Groovy version of Ruby on Rails like framework that let you create web application much more easier with<br />
Dynamic scripting. Despite all that power Grails provided, it is not &quot;light&quot; if you look under the hood. I am not saying Grails is bad or anything. Grails is actually pretty cool to write web application with. However I found myself often want something even lighter and yet still want to prototype with Groovy. So here I will show you a <a href="https://bitbucket.org/saltnlight5/sandbox/downloads/maven-webapp-groovy.zip">maven-groovy-webapp</a> project template that I use to get start any web application development. It's very simple, light, and yet very Groovy.</p>
<h1>How to get started</h1>
<p>Unzip <code>maven-webapp-groovy.zip</code> above and you should see these few files:</p>
<pre><code>bash&gt; cd maven-webapp-groovy
bash&gt; find .
bash&gt; ./pom.xml
bash&gt; ./README.txt
bash&gt; ./src
bash&gt; ./src/main
bash&gt; ./src/main/java
bash&gt; ./src/main/java/deng
bash&gt; ./src/main/java/deng/GroovyContextListener.java
bash&gt; ./src/main/resources
bash&gt; ./src/main/resources/log4j.properties
bash&gt; ./src/main/webapp
bash&gt; ./src/main/webapp/console.gt
bash&gt; ./src/main/webapp/health.gt
bash&gt; ./src/main/webapp/home.gt
bash&gt; ./src/main/webapp/WEB-INF
bash&gt; ./src/main/webapp/WEB-INF/classes
bash&gt; ./src/main/webapp/WEB-INF/classes/.keep
bash&gt; ./src/main/webapp/WEB-INF/groovy
bash&gt; ./src/main/webapp/WEB-INF/groovy/console.groovy
bash&gt; ./src/main/webapp/WEB-INF/groovy/health.groovy
bash&gt; ./src/main/webapp/WEB-INF/groovy/home.groovy
bash&gt; ./src/main/webapp/WEB-INF/groovy/init.groovy
bash&gt; ./src/main/webapp/WEB-INF/groovy/destroy.groovy
bash&gt; ./src/main/webapp/WEB-INF/web.xml
</code></pre>
<p>As you can see it's a maven based application, and I have configured tomcat plugin, so you may run it like this:</p>
<pre><code>bash&gt; mvn tomcat7:run
bash&gt; open http://localhost:8080/maven-webapp-groovy/home.groovy
</code></pre>
<p>And ofcourse, with maven, running package phase will let you deploy it into any real application servers when ready.</p>
<pre><code>bash&gt; mvn package
bash&gt; cp target/maven-webapp-groovy.war $APP_SERVER_HOME/autodeploy
</code></pre>
<h1>What's in it</h1>
<p>You should checkout the main config in <code>web.xml</code> file, and you'll see that there couple built-in Groovy servlets and a custom listener.</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
        version=&quot;2.5&quot;&gt;

    &lt;description&gt;Groovy Web Application&lt;/description&gt;
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;home.groovy&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;GroovyServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;groovy.servlet.GroovyServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;GroovyServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.groovy&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;TemplateServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;groovy.servlet.TemplateServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;TemplateServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.gt&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;deng.GroovyContextListener&lt;/listener-class&gt;
    &lt;/listener&gt;
    &lt;context-param&gt;  
       &lt;param-name&gt;initScripts&lt;/param-name&gt;
       &lt;param-value&gt;/WEB-INF/groovy/init.groovy&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;    
       &lt;param-name&gt;destroyScripts&lt;/param-name&gt;
       &lt;param-value&gt;/WEB-INF/groovy/destroy.groovy&lt;/param-value&gt;
    &lt;/context-param&gt;

&lt;/web-app&gt;
</code></pre>
<p>I've chosen to use <code>GroovyServlet</code> as a controller (it comes with Groovy!), and this let you use any scripts inside <code>/WEB-INF/groovy</code> directory. That's it, no further setup. That's about the only requirement you need to get a Groovy webapp started! See <code>console.groovy</code> as example and how it works. It's a groovy version of <a href="http://saltnlight5.blogspot.com/2012/07/script-console-tool-for-any-war.html">this JVM console</a></p>
<p>Now you can use Groovy to process any logic and even generate the HTML output if you like, but I find it even more easier to use <code>TemplateServlet</code>. This allow Groovy template files to be serve as view. It's very much like JSP, but it uses Groovy instead! And we know Groovy syntax are much shorter to write! See <code>console.gt</code> as exmaple and how it works.</p>
<p>The <code>GroovyContextListener</code> is something I wrote, and it's optional. This allow you to run any scripts during the webapp startup or shutdown states. I've created an empty <code>init.groovy</code> and <code>destroy.groovy</code> placeholder. So now you have all the hooks you need to prototype just about any web application you need.</p>
<h1>Simplicity wins</h1>
<p>This setup is just plain Java Servlet with Groovy loaded. I often think the more simple you get, then less bug and faster you code. No heavy frameworks, no extra learning curve, (other than basic Servlet API and Groovy/Java skills ofcourse), and off you go.</p>
<p>Go have fun with this Groovy webapp template! And let me know if you have some cool prototypes to show off after playing with this. :)</p>
</p>
  			<a href="blog/2012/11/use-cygpath-with-p-option-for-your-java-classpath-conversion.html"><h1>Use cygpath with -p option for your Java CLASSPATH conversion</h1></a>
  			<p>15 November 2012, tags: 
			    <a href="../tags/cygwin.html">cygwin</a> 
  			</p>
  			<p><p>I just noticed that Cygwin's <code>cygpath</code> command supports <code>-p</code> option. This is a real gem when writing Java wrapper script that needs to covert CLASSPATH values. A simple script can demonstrate the purpose.</p>
<pre><code>#!/usr/bin/env bash
# Author: Zemian Deng, Date: 2012-11-16_06:30:00
#
# run.sh - A simple Java wrapper script for Cygwin and Unix/Linux shell. We assume 
# this script is located in a subdiretory inside the application home directory.
# Example:
#   app/bin/run.sh
#   app/config/log4j.properties
#   app/lib/log4j.jar
# Usage:
#   bash&gt; run.sh app.Hello
#
DIR=$(cd &quot;$(dirname $0)/..&quot; &amp;&amp; pwd)
CP=${CP:=&quot;$DIR/config:$DIR/lib/*&quot;}
if [[ &quot;$OS&quot; == Windows* ]]; then
 CP=$(cygpath -mp $CP)
fi
java -cp &quot;$CP&quot; &quot;$@&quot;
</code></pre>
</p>
  			<a href="blog/2012/11/what-does-utf-8-with-bom-mean.html"><h1>What does UTF-8 with BOM mean?</h1></a>
  			<p>02 November 2012  			</p>
  			<p><p>Believe it or not, There is no such thing as Plain Text!</p>
<p>All files in a modern Operating Sytems (Windows, Linux, or MacOSX) are saved with an encoding scheme! They are encoded (a table mapping of what each byte means) in such way so that other programs can read it back and understand how to get information out. It happens that US/ASCII encoding is earliest and widely used that people think it's just &quot;Plain Tex&quot;. But even ASCII is an encoding! It uses 7 bits in mapping all US characters in saving the bytes into file. Obviously you are free to use any kind of encoding (mapping) scheme to save any files, but if you want other programs to read it back easily, then sticking to some standard ones would help a lot. Without an agreed upon encoding, programs will not able to read files and be any useful!</p>
<p>The most useful and practical file encoding today is &quot;UTF-8&quot; because it support Unicode, and it's widely used in internet.</p>
<p>I discovered something odd when using Eclipse and Notepadd++. In Ecilpse, if we set default encoding with UTF-8, it would use normal UTF-8 without the Byte Order Mark (BOM). But in Notepad++, it appears to support UTF-8 wihtout BOM, but it won't recoginze it when first open. You can check this by going Menu &gt; Encoding and see which one is selected. Notepad++ seems to only recognize UTF-8 wihtout BOM with ones it converted by it's own conversion utility. Perhaps it's a bug in notepad++.</p>
<p>So what is BOM? The byte order mark is useless for UTF-8. They only used for UTF-16 so they know which byte order is first. But UTF-8 will allow you to save these BOM for conversion purpose... they are ineffective in encoding the doc itself. So a &quot;normal&quot; UTF-8, it won't have BOM, but Windows would like to use them anyway. The Windows NOTEPAD would automatically save BOM in UTF-8!</p>
<p>So be-aware when viewing UTF-8 without BOM encoding files in Notepad++, as it can be deceiving at first glance.</p>
<p>Ref:</p>
<p><a href="http://en.wikipedia.org/wiki/UTF-8">http://en.wikipedia.org/wiki/UTF-8</a></p>
<p><a href="http://www.joelonsoftware.com/articles/Unicode.html">http://www.joelonsoftware.com/articles/Unicode.html</a></p>
</p>
  			<a href="blog/2012/10/a-simple-way-to-setup-java-application-with-external-configuration-file.html"><h1>A simple way to setup Java application with external configuration file</h1></a>
  			<p>27 October 2012, tags: 
			    <a href="../tags/java.html">java</a> 
  			</p>
  			<p><p>Many Java applications would deploy and run it with some kind of external configuration files. It's very typical that you would want a set of config files per environments such as DEV, QA and PROD. There many options in tackling this problem, especially in a Java app, but keeping it simple and easy to maintain would take some disciplines.</p>
<p>Here I would layout a simple way you may use to depploy a typical Java application. The concept is simple and you can easily apply to a standalone, web, or even a JEE application.</p>
<h2></h2>
<p>Use a env System Properties per environment</p>
<p>Java allows you to invoke any program with extra System Properties added. When launching an Java application, you should set an <code>env</code> property. For example:</p>
<pre><code>bash&gt; java -Denv=prod myapp.Main
</code></pre>
<p>This property would give your <code>Main</code> application to identify which environment you are running against with. You should be reading it like this inside your code:</p>
<pre><code>String env = System.getProperty(&quot;env&quot;, &quot;dev&quot;);
</code></pre>
<p>This way you always would have an environment to work with. Even if user doesn't supply one, it will default to use <code>dev</code> env.</p>
<p>Another useful System Property to set is <code>app.home</code>. You want to set this value in relative to where your application is deployed, so you may reference any files (eg: data) easily. To do this, you can use a script wrapper to automatically calculate the path. See section below for an example.</p>
<h2></h2>
<p>Use a config dir prefix in CLASSPATH</p>
<p>In stead of passing a explicit config file to your application as argument, another flexible way to load configuration file is to add an extra <code>config</code><br />
folder into your CLASSPATH. For example, you can easily create a startup wrapper script <code>myapp.sh</code> like this:</p>
<pre><code>#/usr/bin/env bash
APP_HOME=$(cd &quot;`dirname $0`/..&quot; &amp;&amp; pwd)
java $JAVA_OPTS -Dapp.home=$APP_HOME -cp &quot;$APP_HOME/config:$APP_HOME/lib/*&quot; myapp.Main &quot;$@&quot;
</code></pre>
<p>From this, you can setup the application packaging layout this way:</p>
<pre><code>myapp
    +- bin
        +- myapp.sh
    +- config
        +- dev.properties
        +- qa.properties
        +- prod.properties
    +- data
        +- myrecords.data
    +- lib
        +- myapp-1.0.0.jar
        +- slf4j-1.7.1.jar
</code></pre>
<p>You would typically invoke the application like this:</p>
<pre><code>bash&gt; JAVA_OPTS='-Denv=prod' myapp/bin/myapp.sh
</code></pre>
<p>The above will give you a good foundation to load a single config properties file per <code>env</code>. For example, you can read your properites file like this somewhere in your code.</p>
<pre><code>// Get appHome and data dir.
String appHome = System.getProperty(&quot;app.home&quot;);
String dataDir = appHome + &quot;/data&quot;;

// Get env value to load config parameters
String env = System.getProperty(&quot;env&quot;, &quot;dev&quot;);
String config = env + &quot;.properites&quot;;
Properties configProps = new Properties();
InputStream inStream = null;
try {
    inStream = getClass().getClassLoader().getResourceAsStream(config);
    configProps.load(inStream);
} finally {
    if (inStream != null)
        inStream.close();
}
// Now load any config parameters from configProps map.
</code></pre>
<p>Now you would have the <code>configProps</code> object at your disposal to read any configuration keys and values set per an environment.</p>
<p>NOTE: If you want a more flexible Java wrapper script, see my old post on <a href="http://saltnlight5.blogspot.com/2012/08/a-better-java-shell-script-wrapper.html">run-java</a> wrapper.</p>
<h2></h2>
<p>Do not abuse CLASSPATH</p>
<p>Now, just because you have setup <code>config</code> as part of your CLASSPATH entry, I have to caution you not to abuse it. What I mean is do not go wild on<br />
loading all your application resources in that folder! If you have that many resources that user MUST edit and configure, then you should re-think<br />
about your application design! Simple interface, or configuration in this case, is always a win. Do not bother users with complexity just because<br />
your application can support gazillion ways of configuration combination. If you can keep it as one config file, it would make users very happy.</p>
<p>Also, this doesn't mean you have to put the entire world inside one of <code>prod.properites</code> either. In the real world, an application is likely going to have only<br />
handful of user tunable parameters, and many other resources are less frequent used. I would recommand put the most frequently used parameters in these<br />
config properties only. For all other (for example most of the Spring context files in an application do not belong to a typical users config level, they are more developer level config files. In another word, changing these files would have catastrophic effect to your application!) You should put these inside as part of your <code>myapp.jar</code>.</p>
<p>You might ask, 'Oh, but what happen if I must want to override one of<br />
the resource in the jar?'. But in that very unusual case, you would still have an option to override! You have the <code>config</code> as prefix in CLASSPATH, remember? Even when you nested resources inside a package inside the<br />
jar, you would still able to overwrite by simply create same directory structure inside <code>config</code>. You probably only do this for emmergency and less frequent use anyway.</p>
<h2></h2>
<p>Feedback</p>
<p>So what are some clever ways you have seen or done with your application configuration? I hope to hear from you and share.</p>
</p>
  			<a href="blog/2012/10/simple-variable-substitution-in-java-string.html"><h1>Simple Variable Substitution in Java String</h1></a>
  			<p>24 October 2012, tags: 
			    <a href="../tags/java.html">java</a> 
  			</p>
  			<p><p>When I wrote about how to improve the Java Properties class using <a href="http://saltnlight5.blogspot.com/2012/09/improving-javautilproperties.html">Props</a>, I've shown<br />
a feature where you can use variable substition such as <code>mypath=${user.home}</code> in your config file. The implementation underneath it uses the Apache Common Lang library with <code>org.apache.commons.lang.text.StrSubstitutor</code>. There is nothing wrong with this, but I was curious how bad would it be to remove such dependency, so the <code>Props</code> can be more standalone.</p>
<p>Here is a quick implementation in Groovy, but you should able to translate to Java easily.</p>
<pre><code>// String variable substitutions
def parseVariableNames(String text) {
    def names = []
    def pos = 0, max = text.length()
    while (pos &lt; max) {
        pos = text.indexOf('${', pos)
        if (pos == -1)
            break
        def end = text.indexOf('}', pos + 2)
        if (end == -1)
            break
        def name = text.substring(pos + 2, end)
        names.add(name)
        pos = end + 1
    }
    return names
}
def replaceVariable(String key, String value, String text) {
    //println &quot;DEBUG: Replacing '${key}'' with '${value}'&quot;
    result = text.replaceAll('\\$\\{' + key + '}', value)
    return result
}
</code></pre>
<p>Probably not the most efficient thing, but it should work. Let's have some tests.</p>
<pre><code>// Test
def map = [&quot;name&quot;: &quot;Zemian&quot;, &quot;id&quot;: &quot;1001&quot;]
def inputs  = [
    'Hello ${name}',
    'My id is ${id}',
    '${name} is a good programmer.',
    '${name}\'s id is ${id}.'
]

result = inputs.collect{ line -&gt;
    def names = parseVariableNames(line)
    names.each{ key -&gt;
        line = replaceVariable(key, map.get(key), line) 
    }
    line
}
assert result == [
    'Hello Zemian',
    'My id is 1001',
    'Zemian is a good programmer.',
    'Zemian\'s id is 1001.'
]
</code></pre>
<p>The output should print nothing, as it passed the test. What do you think?</p>
</p>
  			<a href="blog/2012/10/exploring-different-scheduling-types-with-quartz-2.html"><h1>Exploring different scheduling types with Quartz 2</h1></a>
  			<p>22 October 2012, tags: 
			    <a href="../tags/quartz.html">quartz</a> 
  			</p>
  			<p><p>We often think of Cron when we want to schedule a job. Cron is very flexible in expressing an repeating occurance of an event/job in a very compact expression. However it's not answer for everything, as I often see people are asking for help in the Quartz user forum. Did you know that the popular <a href="http://quartz-scheduler.org">Quartz 2</a> library provide many other schedule types (called Trigger) besides cron? I will show you each of the Quartz 2 built-in schedule types here within a complete, standalone Groovy script that you can run and test it out. Let's start with a simple one.</p>
<pre><code>@Grab('org.quartz-scheduler:quartz:2.1.6')
@Grab('org.slf4j:slf4j-simple:1.7.1')
import org.quartz.*
import org.quartz.impl.*
import org.quartz.jobs.*

import static org.quartz.DateBuilder.*
import static org.quartz.JobBuilder.*
import static org.quartz.TriggerBuilder.*
import static org.quartz.SimpleScheduleBuilder.*

def trigger = newTrigger()
    .withSchedule(
        simpleSchedule()
        .withIntervalInSeconds(3)
        .repeatForever())
    .startNow()
    .build()
dates = TriggerUtils.computeFireTimes(trigger, null, 20)
dates.each{ println it }
</code></pre>
<p>This is the Quartz's <code>SimpleTrigger</code>, and it allows you to create a fixed rate repeating job. You can even limit to certain number of count if you like. I have imported all the nessary classes the script needs, and I use the latest Quartz 2.x builder API to create an instance of the trigger.</p>
<p>The quickest way to explore and test out whether a scheduling fits your need is to print out its future execution times. Hence you see me using <code>TriggerUtils.computeFireTimes</code> in the script. Run the above and you should get the datetimes as scheduled to be run, in this case every 3 seconds.</p>
<pre><code>bash&gt; $ groovy simpleTrigger.groovy
    Tue Oct 23 20:28:01 EDT 2012
    Tue Oct 23 20:28:04 EDT 2012
    Tue Oct 23 20:28:07 EDT 2012
    Tue Oct 23 20:28:10 EDT 2012
    Tue Oct 23 20:28:13 EDT 2012
    Tue Oct 23 20:28:16 EDT 2012
    Tue Oct 23 20:28:19 EDT 2012
    Tue Oct 23 20:28:22 EDT 2012
    Tue Oct 23 20:28:25 EDT 2012
    Tue Oct 23 20:28:28 EDT 2012
    Tue Oct 23 20:28:31 EDT 2012
    Tue Oct 23 20:28:34 EDT 2012
    Tue Oct 23 20:28:37 EDT 2012
    Tue Oct 23 20:28:40 EDT 2012
    Tue Oct 23 20:28:43 EDT 2012
    Tue Oct 23 20:28:46 EDT 2012
    Tue Oct 23 20:28:49 EDT 2012
    Tue Oct 23 20:28:52 EDT 2012
    Tue Oct 23 20:28:55 EDT 2012
    Tue Oct 23 20:28:58 EDT 2012
</code></pre>
<p>The most frequent used scheduling type is the <code>CronTrigger</code>, and you can test it out in similar way.</p>
<pre><code>@Grab('org.quartz-scheduler:quartz:2.1.6')
@Grab('org.slf4j:slf4j-simple:1.7.1')
import org.quartz.*
import org.quartz.impl.*
import org.quartz.jobs.*

import static org.quartz.DateBuilder.*
import static org.quartz.JobBuilder.*
import static org.quartz.TriggerBuilder.*
import static org.quartz.CronScheduleBuilder.*

def trigger = newTrigger()
    .withSchedule(cronSchedule(&quot;0 30 08 * * ?&quot;))
    .startNow()
    .build()
dates = TriggerUtils.computeFireTimes(trigger, null, 20)
dates.each{ println it }
</code></pre>
<p>The javadoc for <a href="http://quartz-scheduler.org/api/2.1.5/org/quartz/CronExpression.html">CronExpression</a> is very good and you should definately read it throughly to use it effectively. With the script, you can explore all the combination you want easily and verify future fire times before your job is invoked.</p>
<p>Now, if you have some odd scheduling needs such as run a job every 30 mins from MON to FRI and only between 8:00AM to 10:00AM, then don't try to cramp all that into the Cron expression. The Quartz 2.x has a dedicated trigger type just for this use, and it's<br />
called <code>DailyTimeIntervalTrigger</code>! Check this out:</p>
<pre><code>@Grab('org.quartz-scheduler:quartz:2.1.6')
@Grab('org.slf4j:slf4j-simple:1.7.1')
import org.quartz.*
import org.quartz.impl.*
import org.quartz.jobs.*

import static org.quartz.DateBuilder.*
import static org.quartz.JobBuilder.*
import static org.quartz.TriggerBuilder.*
import static org.quartz.DailyTimeIntervalScheduleBuilder.*
import static java.util.Calendar.*

def trigger = newTrigger()
    .withSchedule(
        dailyTimeIntervalSchedule()
        .startingDailyAt(TimeOfDay.hourMinuteAndSecondOfDay(8, 0, 0))
        .endingDailyAt(TimeOfDay.hourMinuteAndSecondOfDay(10, 0, 0))
        .onDaysOfTheWeek(MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY)
        .withInterval(10, IntervalUnit.MINUTE))
    .startNow()
    .build()
dates = TriggerUtils.computeFireTimes(trigger, null, 20)
dates.each{ println it }
</code></pre>
<p>Another hidden Trigger type from Quartz is <code>CalendarIntervalTrigger</code>, and you would use this if you need to repeat job that's in every interval of a calendar period, such as every year or month etc, where the interval is not fixed, but calendar specific. Here is a test script for that.</p>
<pre><code>@Grab('org.quartz-scheduler:quartz:2.1.6')
@Grab('org.slf4j:slf4j-simple:1.7.1')
import org.quartz.*
import org.quartz.impl.*
import org.quartz.jobs.*

import static org.quartz.DateBuilder.*
import static org.quartz.JobBuilder.*
import static org.quartz.TriggerBuilder.*
import static org.quartz.CalendarIntervalScheduleBuilder.*
import static java.util.Calendar.*

def trigger = newTrigger()
    .withSchedule(
        calendarIntervalSchedule()
        .withInterval(2, IntervalUnit.MONTH))
    .startAt(futureDate(10, IntervalUnit.MINUTE))
    .build()
dates = TriggerUtils.computeFireTimes(trigger, null, 20)
dates.each{ println it }
</code></pre>
<p>I hope these will help you get started on most of your scheduling need with Quartz 2. Try these out and see your future fire times before even scheduling a job into the scheduler should save you some times and troubles.</p>
</p>
  			<a href="blog/2012/10/a-very-lean-war-file-for-myschedule.html"><h1>A very lean war file for MySchedule</h1></a>
  			<p>22 October 2012, tags: 
			    <a href="../tags/myschedule.html">myschedule</a> 

			    <a href="../tags/quartz.html">quartz</a> 
  			</p>
  			<p><p>On the next coming MySchedule release, I've been working on removing few dependencies in the project to improve its size, but yet still keeping all the original functionality.</p>
<p>The <a href="http://code.google.com/p/myschedule/downloads/list">result</a> is about 70% reduction in war file size!</p>
<p>There are few things that I removed that resulted in a much smaller webapp.</p>
<ol>
<li>
<p>Removed MySQL jdbc driver. Not every one uses Quartz with this DB, so including it in distribution is not necessary. You can easily add it into a server classpath without modifying the war.</p>
</li>
<li>
<p>Removed Groovy. I've improved the UI and the ScriptingJob component so that it works with any Java standard script engine. The JDK comes with JavaScript engine built-in! So now Groovy can be optional, and yet user can still use it by simply add it to the server classpath, and they can select the language in MySchedule UI. Without it, MySchedule will just default to JavaScript for scripting.</p>
</li>
<li>
<p>Removed Spring (MVC) Framework. Now this is a big task because MySchedule uses Spring annotations, controllers and service beans in IoC config to bootstrap the entire webapp. I've replaced it with a simple static <a href="http://code.google.com/p/myschedule/source/browse/myschedule-web/src/main/java/myschedule/web/AppConfig.java">AppConfig</a> that wired my services together, and then used the plain Servlet API to process all http requests.</p>
</li>
</ol>
<p>So why remove Spring? Don't get me wrong, I like working with Spring, and I think it's awesome framework. I have been working with Spring based projects for a long time, and I even have my own set of <a href="http://code.google.com/p/zemiandeng/source/browse/springmvc-project-template">SpringMVC template</a> to<br />
start any web application quickly. I know where things are configured and where to add new code to make a Spring app works, and it's flexibility are fantastic for development, especially for larger projects.  But in MySchedule case, it is just a small webapp that has it's focus is on Quartz. I wanted to remove Spring to create less confusion for any one who want to look at the code. The Spring bundled with Quartz in its core, and I want to avoid (I didn't use any of that any way.) I also want to shrink the war file size. And lastly, just to challenge of myself that, yes there is life outside of Spring, and it still can be maintainable. :-P</p>
<p>So in replacing Spring, but kept very much of same coding style, I have created my tiny little web request processing library. It only has few classes, and it will allow me to use single Servlet controller to map and process all URL actions through many smaller unit of code, which I called action handler. Now MySchedule can be easily configured through one <a href="http://code.google.com/p/myschedule/source/browse/myschedule-web/src/main/java/myschedule/web/servlet/app/MainServlet.java">MainServlet</a>class. Not bad!</p>
</p>

	<hr />

	<ul class="pager">
		<li class="previous"><a href="https://zemian.github.io/21">Previous</a></li>
		<li>Page: 22/28</li>
		<li class="next"><a href="https://zemian.github.io/23">Next</a></li>
	</ul>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2011 - Present Zemian Deng All Rights Reserved | Mixed with <a href="http://getbootstrap.com/">Bootstrap v3.1.1</a> | Baked with <a href="http://jbake.org">JBake v2.6.5</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/prettify.js"></script>
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135626598-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-135626598-1');
    </script>

  </body>
</html>