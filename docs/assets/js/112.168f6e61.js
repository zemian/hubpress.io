(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{494:function(e,n,o){"use strict";o.r(n);var t=o(10),r=Object(t.a)({},(function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("p",[e._v("The "),o("code",[e._v("seda")]),e._v(" component in Apache Camel is very similar to the "),o("code",[e._v("direct")]),e._v(" component that I’ve presented in previous blog, but in a asynchronous manner. To do this, it uses a "),o("code",[e._v("java.util.concurrent.BlockingQueue")]),e._v(" as default implementation to queue up messages and disconnect from your main "),o("code",[e._v("Route")]),e._v(" thread and then processing the messages in a separated thread. Because of this "),o("code",[e._v("BlockingQueue")]),e._v(", you need to be aware of the usage and config option.")]),e._v(" "),o("p",[e._v("One option needs to be aware of asynchronous processing is the it default to queue size is unbound, meaning it will grow as much as your memory allowed. To cap this, set "),o("code",[e._v("size=1000")]),e._v(". Let’s see an example.")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",[o("code",[e._v('package camelcoredemo;\n\nimport org.slf4j.*;\nimport org.apache.camel.*;\nimport org.apache.camel.builder.*;\nimport org.apache.camel.main.Main;\nimport java.io.*;\n\npublic class SedaDemoCamel extends Main {\n    static Logger LOG = LoggerFactory.getLogger(SedaDemoCamel.class);\n    public static void main(String[] args) throws Exception {\n        SedaDemoCamel main = new SedaDemoCamel();\n        main.enableHangupSupport();\n        main.addRouteBuilder(createRouteBuilder1());\n        main.addRouteBuilder(createRouteBuilder2());\n        main.addRouteBuilder(createRouteBuilder3());\n        main.run(args);\n    }\n    // The file poller route\n    static RouteBuilder createRouteBuilder1() {\n        return new RouteBuilder() {\n            public void configure() {\n                from("file://target/input?preMove=staging&move=.processed")\n                .process(new Processor() {\n                    public void process(Exchange msg) {\n                        CamelContext camelContext = msg.getContext();\n                        ProducerTemplate producer = camelContext.createProducerTemplate();\n                        String text = msg.getIn().getBody(String.class);\n                        String fileName = (String)msg.getIn().getHeader("CamelFileName");\n                        boolean specialFile = fileName.endsWith("_SPECIAL.dat");\n                        if (specialFile)\n                            producer.sendBody("seda:specialRoute", text);\n                        else\n                            producer.sendBody("seda:normalRoute", text);\n                    }\n                });\n            }\n        };\n    }\n    // The special file processing route\n    static RouteBuilder createRouteBuilder2() {\n        return new RouteBuilder() {\n            public void configure() {\n                from("seda:specialRoute")\n                .process(new Processor() {\n                    public void process(Exchange msg) {\n                        LOG.info("Processing special file: " + msg);\n                    }\n                });\n            }\n        };\n    }\n    // The normal file processing route\n    static RouteBuilder createRouteBuilder3() {\n        return new RouteBuilder() {\n            public void configure() {\n                from("seda:normalRoute")\n                .process(new Processor() {\n                    public void process(Exchange msg) {\n                        LOG.info("Processing normal file: " + msg);\n                    }\n                });\n            }\n        };\n    }\n}\n')])])]),o("p",[e._v("You will notice that this demo code is very similar to the "),o("code",[e._v("direct")]),e._v(" component demo, with few differences. First, we use "),o("code",[e._v("seda")]),e._v(" endpoints. Second, in file poller, we read in the entire file content text. We do this because we are now passing to an asynchronous "),o("code",[e._v("Route")]),e._v(" that will runs on separate threads. The poller is configured to move the processed file into different folder right after the first "),o("code",[e._v("Route")]),e._v(" has ended. So we must ensure the processing "),o("code",[e._v("Route")]),e._v(" is not depended on the path of the File, hence we will load entire text in instead.")]),e._v(" "),o("p",[e._v("Another interesting "),o("code",[e._v("seda")]),e._v(" option is you may set the number of concurrent threads to receive the messages to process them! Let’s say if your "),o("strong",[e._v("normal")]),e._v(" files are heavy in traffic, then you can configure to use more threads on that part (default is just one thread.)")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",[o("code",[e._v('from("seda:normalRoute?concurrentConsumers=10")\n.process(new Processor() {\n    public void process(Exchange msg) {\n        LOG.info("Processing normal file: " + msg);\n    }\n});\n')])])]),o("p",[e._v("To verify that your are running concurrently, you can easily configure your logger to display thread name. For\nexample with "),o("code",[e._v("log4j")]),e._v(", you can use this pattern:")]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",[o("code",[e._v("log4j.rootLogger=INFO, stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d %p %t [%c] - %m%n\n")])])]),o("p",[e._v("There are more options availabe from "),o("a",{attrs:{href:"http://camel.apache.org/seda.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Seda"),o("OutboundLink")],1),e._v(" component\nthat you may explore.\n"),o("a",{attrs:{href:"http://saltnlight5.blogspot.com/2013/08/getting-started-with-apache-camel-using.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Try it out with a Route"),o("OutboundLink")],1),e._v("\nand see it for yourself.")])])}),[],!1,null,null,null);n.default=r.exports}}]);