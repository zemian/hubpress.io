<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Zemian's Blog &middot; Life in programming world!
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/page3/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2019/01/15/getting-started-with-jbake/">
        Getting Started with jbake
      </a>
    </h1>

    <span class="post-date">15 Jan 2019</span>

    <p>I started using <a href="https://jbake.org/">https://jbake.org/</a> for <a href="https://zemian.github.io/">my blog
site</a> here at GitHub page. It’s a Java based
static site generator that has decent options. For Java developers, it’s
easy to learn and use. I can customize the site with Freemarker (and
other templates as well).</p>

<p>So far I am pretty happy with this.</p>

<h1 id="getting-started">Getting Started</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir hello-site
cd hello-site
jbake -i
jbake -b -s
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">-b</code> option is for baking (generating) the content, and the <code class="language-plaintext highlighter-rouge">-s</code> is
to run a server for testing it. The default output of the site will be
in <code class="language-plaintext highlighter-rouge">output</code> folder. You can change it as <code class="language-plaintext highlighter-rouge">jbake -b -s . my-site-output</code></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/24/python-string-successor-method/">
        Python string successor method
      </a>
    </h1>

    <span class="post-date">24 Aug 2018</span>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A simple implementation of Ruby's String#next() successor method in Python
# See https://ruby-doc.org/core-2.4.1/String.html#method-i-next
def next(id_template, id_chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"):
        first_ch = id_chars[0]
        last_ch = id_chars[-1]
        new_id = list(id_template)

        idx = len(new_id) - 1
        while idx &gt;= 0:
                ch = new_id[idx]
                if ch == last_ch:
                        new_id[idx] = first_ch
                else:
                        next_idx = id_chars.index(ch) + 1
                        new_id[idx] = id_chars[next_idx]
                        break
                idx -= 1

        return ''.join(new_id)

# Tests
import unittest
class StringNextTest(unittest.TestCase):
        def test_next(self):
                self.assertEqual(next("0"), "1");
                self.assertEqual(next("9"), "A");
                self.assertEqual(next("A"), "B");
                self.assertEqual(next("Y"), "Z");
                self.assertEqual(next("Z"), "0");

                self.assertEqual(next("AAA"), "AAB");
                self.assertEqual(next("AAB"), "AAC");
                self.assertEqual(next("AAC"), "AAD");
                self.assertEqual(next("ZZ0"), "ZZ1");
                self.assertEqual(next("ZZ1"), "ZZ2");
                self.assertEqual(next("ZZ2"), "ZZ3");
                self.assertEqual(next("ZZY"), "ZZZ");
                self.assertEqual(next("ZZZ"), "000");
                self.assertEqual(next("ZZZZZZ"), "000000");
                self.assertEqual(next("ZZZZZZZZZ"), "000000000");

                self.assertEqual(next("ABC999GHI"), "ABC999GHJ");
                self.assertEqual(next("ABC999GZZ"), "ABC999H00");

        def samples(self):
                id = "ZZX"
                print(id)
                for i in range(10):
                        id = next(id)
                        print(id)

                id = "FF9"
                print(id)
                for i in range(10):
                        id = next(id, "0123456789ABCDEF")
                        print(id)

if __name__ == '__main__':
        #StringNextTest().samples()
        unittest.main()
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/21/sqlite3-data-types-and-test-table/">
        SQLite3 Data Types and Test Table
      </a>
    </h1>

    <span class="post-date">21 Aug 2018</span>

    <p>A quick sql table setup to test most common data types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Notes for SQLite3 Database (3.24)
-- https://www.sqlite.org/docs.html

-- Data Types
-- https://www.sqlite.org/datatype3.html

-- Functions
-- https://www.sqlite.org/lang_corefunc.html

/*
SQLite does not have strong data type, but dynamic type that define by value rather than by schema/container.

SQLite only has 5 storage class that it can be used to store data (desc their doc):

NULL. The value is a NULL value.
INTEGER. The value is a signed integer, stored in 1, 2, 3, 4, 6, or 8 bytes depending on the magnitude of the value.
REAL. The value is a floating point value, stored as an 8-byte IEEE floating point number.
TEXT. The value is a text string, stored using the database encoding (UTF-8, UTF-16BE or UTF-16LE).
BLOB. The value is a blob of data, stored exactly as it was input.

SQLite can conform to standard SQL types by mapping what's called "affinity" type.

CHAR          Map to TEXT
VARCHAR       Map to TEXT
TEXT          Map to TEXT

INT           Map to INTEGER

REAL             Map to REAL
DOUBLE PRECISION Map to REAL

NUMERIC       Map to INTEGER, REAL, TEXT or BLOB

DATE          Map to INTEGER, REAL, TEXT or BLOB
DATETIME      Map to INTEGER, REAL, TEXT or BLOB

NOTE: Despite there is a "NUMERIC" affinity type, it's not a fixed-point type! SQLite
does not have native NUMERIC. It will dynamically choose a best fit storage class
instead (REAL if it can keep 15 digits accuracy). If you need true fixed point data type,
you may try to use TEXT data stored instead. Same as with DATETIME types. For example you
can store DATETIME as TEXT, and then SQLite provides many built-in functions that help you
manipulate dates instead. Note also that precision and scale such as VARCHAR(n) or
NUMERIC(p, s) has no real meaning other than DDL schema documentation only!

The SQLite INT size can auto grow into 64-bits (like sql: BIGINT) if needed. The REAL type
is 64-bits size! (unlike many other DB that use REAL for 32-bits and DOUBLE PRECISION for
64 bits).
 */

-- Test table
create table test(
  id      integer primary key,
  ts      text default (datetime('now')),
  cat     text,

  price   text,
  qty     int,

  txtdata text,
  bindata blob,

  distx   real,
  disty   real
);
insert into test(cat, price, qty) values ('test', 100000.10, 50000),
                                         ('test', 100000.20, 0),
                                         ('test', 100000.00, 1),
                                         ('test', 9977000.3333, 179),
                                         ('test', 104729.1129, 104729);
insert into test(cat, bindata, txtdata) values ('test2', x'CAFEBABE', 'CAFEBABE');
insert into test(cat, bindata) values ('test3', randomblob(16));
insert into test(cat, bindata) values ('test3', randomblob(16));
insert into test(cat, bindata) values ('test3', randomblob(16));
update test set txtdata = hex(bindata) where cat = 'test3';
insert into test(cat, distx, disty) values ('test4', random(), random());
insert into test(cat, distx, disty) values ('test4', random(), random());
insert into test(cat, distx, disty) values ('test4', random(), random());
select sum(price) from test where cat = 'test';
select * from test order by cat, ts desc;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/20/postgresql-data-types-and-test-table/">
        PostgreSQL Data Types and Test Table
      </a>
    </h1>

    <span class="post-date">20 Aug 2018</span>

    <p>A quick sql table setup to test most common data types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Notes for PostgreSQL Database (9.6)
-- https://www.postgresql.org/docs/9.6/static/index.html

-- Data Types
-- https://www.postgresql.org/docs/9.6/static/datatype.html

/*

CHAR          Fixed length and space padded character string (sql: CHAR)
VARCHAR       Variable length character string (sql: VARCHAR)
TEXT          Variable length character large string (sql: TEXT)

INT           Declare integer number (sql: INT 32 bits)
SMALLINT      16 bits
BIGINT        64 bits
SERIAL        Auto increment integer (INT with sequence)

REAL             Declare floating-point number 32 bits
DOUBLE PRECISION Declare floating-point number 64 bits

NUMERIC(p,s)     Declare fixed-point number (sql: NUMERIC)

DATE          Declare date
TIME          Declare time
TIMESTAMP     Declare datetime
TIMESTAMP WITH TIMEZONE or TIMESTAMPTZ
              Declare datetime as timezone aware (stored as UTC but convert to client session timezone)
INTERVAL      Declare period of time difference

BYTEA         Binary data

 */
-- test table
create table test(
  id       serial primary key,
  ts       timestamptz default current_timestamp,
  cat      varchar(10),

  price    numeric(19,4),
  qty      int,

  txtdata  text,
  bindata  bytea,

  distx    real,
  disty    double precision
);
insert into test(cat, price, qty) values ('test', 100000.10, 50000),
                                         ('test', 100000.20, 0),
                                         ('test', 100000.00, 1),
                                         ('test', 9977000.3333, 179),
                                         ('test', 104729.1129, 104729);
insert into test(cat, bindata, txtdata) values ('test2', E'\\xCAFEBABE', 'CAFEBABE');
insert into test(cat, bindata) values ('test3', decode(md5(random()::text), 'hex'));
insert into test(cat, bindata) values ('test3', decode(md5(random()::text), 'hex'));
insert into test(cat, bindata) values ('test3', decode(md5(random()::text), 'hex'));
update test set txtdata = encode(bindata, 'hex') where cat = 'test3';
insert into test(cat, distx, disty) values ('test4', random(), random());
insert into test(cat, distx, disty) values ('test4', random(), random());
insert into test(cat, distx, disty) values ('test4', random(), random());
select sum(price) from test where cat = 'test';
select * from test order by cat, ts desc;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/19/sybase-data-types-and-test-table/">
        Sybase Data Types and Test Table
      </a>
    </h1>

    <span class="post-date">19 Aug 2018</span>

    <p>A quick sql table setup to test most common data types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Notes for Sybase Database 16
-- http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc70202.1570/html/quickref/title.htm

-- Data Types
-- http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc32300.1600/doc/html/san1390612189202.html

/*

CHAR          Fixed length and space padded character string (sql: CHAR)
VARCHAR       Variable length character string (sql: VARCHAR)
UNIVARCHAR    Same as VARCHAR but with Unicode support
TEXT          Variable length character large string (sql: TEXT)

INT           Declare integer number (sql: INT 32 bits)
SMALLINT      16 bits
BIGINT        64 bits

REAL             Declare floating-point number 32 bits
DOUBLE PRECISION Declare floating-point number 64 bits

NUMERIC(p,s)     Declare fixed-point number (sql: NUMERIC)

DATE          Declare date
TIME          Declare time
DATETIME      Declare datetime with sub second precision

BINARY        Binary data
BINARY        Binary data
BINARY        Binary data

 */
-- Test table
create table test(
  id    int identity primary key not null,
  ts    datetime default getdate() not null,
  cat   varchar(10) not null,

  price    numeric(19,4) null,
  qty      int null,

  txtdata  text null,
  bindata  binary null,

  distx  real null,
  disty  double precision null
);
insert into test(cat, price, qty) values ('test', 100000.10, 50000),
                                         ('test', 100000.20, 0),
                                         ('test', 100000.00, 1),
                                         ('test', 9977000.3333, 179),
                                         ('test', 104729.1129, 104729);
insert into test(cat, bindata, txtdata) values ('test2', 0xCAFEBABE, 'CAFEBABE');
insert into test(cat, bindata) values ('test3', convert(binary, rand()));
insert into test(cat, bindata) values ('test3', convert(binary, rand()));
insert into test(cat, bindata) values ('test3', convert(binary, rand()));
insert into test(cat, distx, disty) values ('test4', rand(), rand());
insert into test(cat, distx, disty) values ('test4', rand(), rand());
insert into test(cat, distx, disty) values ('test4', rand(), rand());
select sum(price) from test where cat = 'test';
select * from test order by cat, ts desc;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/18/oracle-db-data-types-and-test-table/">
        Oracle DB Data Types and Test Table
      </a>
    </h1>

    <span class="post-date">18 Aug 2018</span>

    <p>A quick sql table setup to test most common data types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--
-- Notes on Oracle Database 12.2
-- https://docs.oracle.com/en/database/oracle/oracle-database/12.2/administration.html

-- DataTypes
-- https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sqlrf/Data-Types.html

/*
CHAR          Fixed length and space padded character string (sql: CHAR)
VARCHAR2      Variable length character string (sql: VARCHAR)
              (Oracle discourage use of VARCHAR, even though it's same as VARCHAR2 as of now.)
NVARCHAR2     Same as VARCHAR2 but with Unicode support
CLOB          Variable length character large string (sql: TEXT)

NUMBER(p)     Declare integer number (sql: INT)

BINARY_FLOAT  Declare floating-point number (sql: REAL 32 bits)
BINARY_DOUBLE Declare floating-point number (sql: DOUBLE PRECISION 64 bits)

NUMBER        Declare floating-point number (like NUMERIC with max precision and scale. Values will be stored as exact, not binary.)
NUMBER(p,s)   Declare fixed-point number (sql: NUMERIC)

DATE          Declare datetime with no sub second precision (note: it includes time!)
TIMESTAMP     Declare datetime with sub second precision
TIMESTAMP WITH TIMEZONE
              Declare datetime with sub second precision and timezone
INTERVAL YEAR TO MONTH   Declare period of time difference
INTERVAL DAY TO DECOND   Declare period of time difference

BLOB          Binary data
 */

-- Test table
create table test (
  id    number(32) generated always as identity primary key,
  ts    timestamp(6) default systimestamp not null,
  cat   varchar2(10) not null,

  price    number(19,4) null,
  qty      int null,

  txtdata  varchar2(1000) null,
  bindata  blob null,

  distx  binary_float null,
  disty  binary_double null
);
insert into test(cat, price, qty) values ('test', 100000.10, 50000),
                                         ('test', 100000.20, 0),
                                         ('test', 100000.00, 1),
                                         ('test', 9977000.3333, 179),
                                         ('test', 104729.1129, 104729);
insert into test(cat, bindata, txtdata) values ('test2', hextoraw('CAFEBABE'), 'CAFEBABE');
insert into test(cat, bindata) values ('test3', hextoraw(to_char(floor(dbms_random.value(0,256)), 'XX')));
insert into test(cat, bindata) values ('test3', hextoraw(to_char(floor(dbms_random.value(0,256)), 'XX')));
insert into test(cat, bindata) values ('test3', hextoraw(to_char(floor(dbms_random.value(0,256)), 'XX')));
update test set txtdata = rawtohex(bindata) where cat = 'test3';
insert into test(cat, distx, disty) values ('test4', dbms_random.value(0.0, 1.0), dbms_random.value(0.0, 1.0));
insert into test(cat, distx, disty) values ('test4', dbms_random.value(0.0, 1.0), dbms_random.value(0.0, 1.0));
insert into test(cat, distx, disty) values ('test4', dbms_random.value(0.0, 1.0), dbms_random.value(0.0, 1.0));
select sum(price) from test where cat = 'test';
select * from test order by cat, ts desc;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/17/mysql-data-types-and-test-table/">
        MySQL Data Types and Test Table
      </a>
    </h1>

    <span class="post-date">17 Aug 2018</span>

    <p>A quick sql table setup to test most common data types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Notes for MySQL (8)
-- https://dev.mysql.com/doc/refman/8.0/en/

-- Data Types
-- https://dev.mysql.com/doc/refman/8.0/en/data-types.html

/*

CHAR          Fixed length and space padded character string (sql: CHAR)
VARCHAR       Variable length character string (sql: VARCHAR)
TEXT          Variable length character large string (sql: TEXT)

INT           Declare integer number (sql: INT 32 bits)
SMALLINT      16 bits
BIGINT        64 bits
SERIAL        Auto increment integer (INT with sequence)
              An alias for BIGINT UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE.

REAL             Declare floating-point number 32 bits
DOUBLE PRECISION Declare floating-point number 64 bits

NUMERIC(p,s)     Declare fixed-point number (sql: NUMERIC)

DATE          Declare date
TIME          Declare time
TIMESTAMP     Declare datetime (stored as UTC but convert to client session timezone)

BLOB          Binary data

 */

-- test table
create table test(
  id       serial primary key,
  ts       timestamp default current_timestamp,
  cat      varchar(10),

  price    numeric(19,4),
  qty      int,

  txtdata  text,
  bindata  blob,

  distx    real,
  disty    double precision
);
insert into test(cat, price, qty) values ('test', 100000.10, 50000),
                                         ('test', 100000.20, 0),
                                         ('test', 100000.00, 1),
                                         ('test', 9977000.3333, 179),
                                         ('test', 104729.1129, 104729);
insert into test(cat, bindata, txtdata) values ('test2', X'CAFEBABE', 'CAFEBABE');
insert into test(cat, bindata) values ('test3', unhex(replace(uuid(), '-','')));
insert into test(cat, bindata) values ('test3', unhex(replace(uuid(), '-','')));
insert into test(cat, bindata) values ('test3', unhex(replace(uuid(), '-','')));
update test set txtdata = hex(bindata) where cat = 'test3';
insert into test(cat, distx, disty) values ('test4', rand(), rand());
insert into test(cat, distx, disty) values ('test4', rand(), rand());
insert into test(cat, distx, disty) values ('test4', rand(), rand());
select sum(price) from test where cat = 'test';
select * from test order by cat, ts desc;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/13/a-simple-java-command-line-options-parser/">
        A simple Java command line options parser
      </a>
    </h1>

    <span class="post-date">13 Aug 2018</span>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package com.zemian.hellojava;

import java.util.*;

/**
 * A simple command line arguments and options parser in the format of "--optionName=optionValue" or
 * "-optionName=optionValue".
 *
 * The optionName can be one ore more characters. The equals sign must be used when providing optionValue;
 * else it will be treated as program arguments instead! If you ommit the "=optionValue" part, then it
 * will default to "=true" for that optionName. The optionValue must be a single string. Any other argument
 * that are not part of options are store in a new args list.
 *
 * The constructor will immediately parse the input arguments, and it should not throw any exceptions. In case
 * user did not use correct format, by above rule, it will go into the argument list instead. We purposely made
 * this class simple, and let end user to perform any validation they need for their program.
 *
 * Usage example:
 *   Hello --help
 *   Hello --num=101 --verbose one two three
 * ----
 * public class Hello {}
 *     public static void main(String[] args) {
 *         CmdOpts opts = new CmdOpts(args);
 *         if (opts.hasOpt("help"))
 *           System.out.println("You need help");
 *         int num = opts.getIntOpt("num", 0);
 *         System.out.println("Using num=" + num);
 *         System.out.println("Using new args=" + opts.getArgs());
 *     }
 * }
 * ----
 *
 * Created by Zemian Deng 2017.
 */
public class CmdOpts {
    private Map&lt;String, Object&gt; opts = new HashMap&lt;&gt;();
    private List&lt;String&gt; args = new ArrayList&lt;&gt;();

    public CmdOpts(String[] arguments) {
        parse(arguments);
    }

    private void parse(String[] arguments) {
        for (String arg : arguments) {
            if (arg.startsWith("--")) {
                addOpt(arg.substring(2));
            } else if (arg.startsWith("-")) {
                addOpt(arg.substring(1));
            } else {
                args.add(arg);
            }

        }
    }

    private void addOpt(String option) {
        if (option != null &amp;&amp; !"".equals(option)) {
            String[] options = option.split("=", 2);
            String optionName = options[0];
            String optionValue = "true";
            if (options.length == 2) {
                optionValue = options[1];
            }

            Object existingOpt = opts.get(optionName);
            if (existingOpt == null) {
                opts.put(optionName, optionValue);
            } else {
                // Support multi options with same key
                if (existingOpt instanceof List) {
                    // Third + items
                    ((List&lt;String&gt;) existingOpt).add(optionValue);
                } else {
                    // Second items
                    List&lt;String&gt; list = new ArrayList&lt;&gt;();
                    list.add((String) existingOpt);
                    list.add(optionValue);
                    opts.put(optionName, list);
                }
            }
        }
    }

    public int getOptsSize() {
        return opts.size();
    }

    public Set&lt;String&gt; getOptsNames() {
        return opts.keySet();
    }

    public boolean hasOpt(String name) {
        return opts.containsKey(name);
    }

    public Map&lt;String, Object&gt; getOpts() {
        return opts;
    }

    public void setOpts(Map&lt;String, Object&gt; opts) {
        this.opts = opts;
    }

    public String getOpt(String name) {
        return (String) opts.get(name);
    }

    public String getOpt(String name, String def) {
        String result = getOpt(name);
        if (result == null)
            result = def;
        return result;
    }

    public boolean getBooleanOpt(String name) {
        if (hasOpt(name)) {
            return true;
        }
        return Boolean.parseBoolean(getOpt(name));
    }

    public boolean getBooleanOpt(String name, boolean def) {
        if (hasOpt(name)) {
            return true;
        }
        String result = getOpt(name);
        if (result == null)
            return def;
        return Boolean.parseBoolean(result);
    }

    public int getIntOpt(String name) {
        return Integer.parseInt(getOpt(name));
    }

    public int getIntOpt(String name, int def) {
        String result = getOpt(name);
        if (result == null)
            return def;
        return Integer.parseInt(result);
    }

    public long getLongOpt(String name) {
        return Long.parseLong(getOpt(name));
    }

    public long getLongOpt(String name, long def) {
        String result = getOpt(name);
        if (result == null)
            return def;
        return Long.parseLong(result);
    }

    public List&lt;String&gt; getMultiOpts(String name) {
        List&lt;String&gt; list = new ArrayList&lt;&gt;();
        Object optVal = opts.get(name);
        if (optVal == null) {
            return list;
        } else if (optVal instanceof String) {
            list.add((String) optVal);
            return list;
        }

        list.addAll((List&lt;String&gt;) optVal);
        return list;
    }

    public int getArgsSize() {
        return args.size();
    }
    public List&lt;String&gt; getArgs() {
        return args;
    }
    public String[] getArgsArray() {
        return args.toArray(new String[args.size()]);
    }

    public String getArgOrError(int index, String errorIfMissing) {
        if (index &gt;= args.size() || index &lt; 0) {
            throw new IllegalArgumentException(errorIfMissing);
        }
        return args.get(index);
    }

    public String getArg(int index) {
        return args.get(index);
    }

    /** A test class to try out CmdOpts. */
    public static void main(String[] args) {
        CmdOpts opts = new CmdOpts(args);
        if (opts.hasOpt("help"))
            System.out.println("You need help");
        int num = opts.getIntOpt("num", 0);
        System.out.println("Using num=" + num);
        System.out.println("Using new args=" + opts.getArgs());
    }
}
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/08/09/examples-of-postgres-functions-and-triggers/">
        Examples of Postgres Functions and Triggers
      </a>
    </h1>

    <span class="post-date">09 Aug 2018</span>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Simple Function
create or replace function rand_range(a int, b int) returns int
as $$
  -- return a random range of int between a and b, both inclusive!;
  select cast(floor(random()*((b + 1)-a)+a) as int);
$$ language sql;
select rand_range(1, 10);
select rand_range(90, 95) from generate_series(1, 10);

-- Function to print message on DB server
create or replace function print_msg(msg text, lev text default 'notice') returns void
  as $$
  begin
    case
      when lev = 'debug' then
        raise debug '%', msg;
      when lev = 'info' then
        raise info '%', msg;
      else
        raise notice '%', msg;
    end case;
  end;
$$ language plpgsql;
select print_msg('hello world');

-- Log Function
drop table log;
create table log(
  id serial,
  msg text not null,
  ts timestamptz default current_timestamp not null,
  category varchar(50) default 'INFO' not null,
  user_id varchar(50) default 'system' not null,
  source_info text null
);
create or replace function add_log(
  msg text,
  category varchar(50) default 'INFO'
) returns void
as $$
begin
  insert into log(msg, category, source_info, user_id)
    values(msg, category, 'client=' || inet_client_addr(), current_user);
end;
$$ language plpgsql;

select add_log('hello2');
select public.add_log('hello3');
select * from log;

-- Triggers to log data entry or update
drop table test;
create table test(id serial, f1 real);
create or replace function log_test_update() returns trigger
as $$
begin
  perform add_log('Insert or Update on test table');
  return NEW;
end
$$ language plpgsql;
create trigger test_logging_trigger
  after insert or update on test
  for each row
  execute procedure log_test_update();
insert into test(f1) values(0.10), (0.20), (0.30);
update test set f1 = 3.5 where id = 1;
select * from test;
select * from log;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/07/28/a-plain-and-simple-jdbc-service-for-java8/">
        A plain and simple Jdbc service for Java8
      </a>
    </h1>

    <span class="post-date">28 Jul 2018</span>

    <p>With Java8, we can create simple and thin Jdbc service that’s productive
and easy to use. This service implementation is inspired by Spring’s
JdbcTemplate, but much lighter and has zero dependency.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package zemian.jdbc;

import javax.sql.DataSource;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.sql.*;
import java.util.*;
import java.util.stream.Collectors;

/**
 * This class provide an easier interface to run SQLs and retrieve data than direct Java JDBC API.
 *
 * You can instantiate this class in two ways:
 *
 * - Method1: Using a DataSource. Each operation will get a Connection object from the #dataSource.
 * - Method2: Using a direct Connection object. Use this to reuse a single connection to perform all
 *            JDBC operations.
 *
 * Both methods above will not directly close the Connection object per Jdbc instance. It's user
 * responsibility to close it after use. For pooled DataSource, it should be automatic, else you
 * might want to use the Jdbc.withJdbc() convenient method. This method will let you quickly start a single
 * new DB connection and Jdbc instance, and it will auto close connection when method is exited.
 *
 * This class provide these easy methods to work with DB data:
 * - #execute() perform update SQLs that returns number of records updated.
 * - #query() perform select SQLs that returns a list of records.
 * - #get() perform select SQLs that return a single object element.
 * - #insert() perform table insert using a Map as record.
 * - #update() perform table update using a Map as record.
 *
 * The #query() and #get() methods allow you to provide custom RSMapper to convert ResultSet instance
 * into any user object.
 *
 * @author Zemian Deng 2018-07-28
 */
public class Jdbc {
    // == Static utility methods and supporting inner classes
    public static void withJdbc(String propsResourceName, JdbcAction task) {
        Properties props = new Properties();
        URL propsUrl = Thread.currentThread().getContextClassLoader().getResource(propsResourceName);
        try (InputStream ins = propsUrl.openStream()) {
            props.load(ins);
        } catch (IOException e) {
            throw new RuntimeException("Unable to open properties from resource: " + propsResourceName, e);
        }
        withJdbc(props, task);
    }

    public static void withJdbc(String url, String user, String password, JdbcAction task) {
        Properties props = new Properties();
        props.setProperty("url", url);
        props.setProperty("user", user);
        props.setProperty("password", password);
        withJdbc(props, task);
    }

    public static void withJdbc(Properties jdbcProps, JdbcAction task) {
        try (Connection conn = DriverManager.getConnection(jdbcProps.getProperty("url"), jdbcProps)) {
            Jdbc jdbc = new Jdbc(conn);
            task.runJdbc(jdbc);
        } catch (Exception e) {
            if (e instanceof RuntimeException)
                throw (RuntimeException) e;
            throw new RuntimeException("Failed to process Jdbc", e);
        }
    }

    public static List&lt;String&gt; getFieldNames(ResultSet rs) throws SQLException {
        List&lt;String&gt; names = new ArrayList&lt;&gt;();
        ResultSetMetaData md = rs.getMetaData();
        for (int i = 1, max = md.getColumnCount(); i &lt;= max; i++) {
            names.add(md.getColumnName(i));
        }
        return names;
    }

    public static void setParams(PreparedStatement st, Object[] params) throws SQLException {
        for (int i = 0; i &lt; params.length; i++) {
            st.setObject(i + 1, params[i]);
        }
    }

    interface JdbcAction {
        void runJdbc(Jdbc jdbc) throws Exception;
    }

    interface ConnAction&lt;T&gt; {
        T runConn(Connection conn) throws Exception;
    }

    interface ConnActionNoRet {
        void runConn(Connection conn) throws Exception;
    }

    interface RSMapper&lt;T&gt; {
        T map(ResultSet rs, int idx) throws Exception;
    }

    public static class Record extends HashMap&lt;String, Object&gt; {
        public Record() {}
        public Record(ResultSet rs) throws SQLException {
            this(rs, Jdbc.getFieldNames(rs));
        }
        public Record(ResultSet rs, List&lt;String&gt; names) throws SQLException {
            for (String name : names) {
                Object val = rs.getObject(name);
                put(name, val);
            }
        }
        public Record(Object ... entries) {
            for (int i = 0; i &lt; entries.length; i+= 2) {
                Object key = entries[i];
                Object val = entries[i + 1];
                put(key.toString(), val);
            }
        }
        public &lt;T&gt; T getValue(String key) {
            return (T) get(key);
        }
        public List&lt;String&gt; getFieldNames() {
            return new ArrayList&lt;&gt;(keySet());
        }
        @Override
        public String toString() {
            return "Record" + super.toString();
        }
    }

    // == Jdbc Service implementation
    private DataSource dataSource;
    private Connection conn;

    public Jdbc(Connection conn) {
        this.conn = conn;
    }

    public Jdbc(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    public Connection getConn() throws SQLException {
        if (conn != null) {
            return conn;
        } else {
            return dataSource.getConnection();
        }
    }

    public &lt;T&gt; T withConn(ConnAction&lt;T&gt; action) {
        try {
            return action.runConn(getConn());
        } catch (Exception e) {
            if (e instanceof RuntimeException)
                throw (RuntimeException) e;
            throw new RuntimeException("Failed to process DB conn", e);
        }
    }

    public void withConnNoRet(ConnActionNoRet action) {
        withConn(conn -&gt; {
            action.runConn(conn);
            return null;
        });
    }

    public &lt;T&gt; T get(String sql, Object ... params) {
        return get((rs, idx) -&gt; (T) rs.getObject(1), sql, params);
    }

    public &lt;T&gt; T get(RSMapper&lt;T&gt; mapper, String sql, Object ... params) {
        return withConn(conn -&gt; {
            try (PreparedStatement st = conn.prepareStatement(sql)) {
                setParams(st, params);
                st.executeQuery();
                try (ResultSet rs = st.getResultSet()) {
                    if (rs.next()) {
                        return mapper.map(rs, 0);
                    }
                }
            }
            throw new RuntimeException("There is no unique record from query.");
        });
    }

    public Record getRecord(String sql, Object ... params) {
        return get((rs, idx) -&gt; new Record(rs), sql, params);
    }

    public List&lt;Record&gt; query(String sql, Object ... params) {
        final List&lt;String&gt; names = new ArrayList&lt;&gt;();
        return query((rs, idx) -&gt; {
            if (idx == 0) {
                names.addAll(getFieldNames(rs));
            }
            return new Record(rs, names);
        }, sql, params);
    }

    public &lt;T&gt; List&lt;T&gt; query(RSMapper&lt;T&gt; mapper, String sql, Object ... params) {
        return withConn(conn -&gt; {
            List&lt;T&gt; list = new ArrayList&lt;&gt;();
            try (PreparedStatement st = conn.prepareStatement(sql)) {
                setParams(st, params);
                st.executeQuery();
                try (ResultSet rs = st.getResultSet()) {
                    int idx = 0;
                    while (rs.next()) {
                        T t = mapper.map(rs, idx++);
                        list.add(t);
                    }
                }
            }
            return list;
        });
    }

    public int execute(String sql, Object ... params) {
        return withConn(conn -&gt; {
            try (PreparedStatement st = conn.prepareStatement(sql)) {
                setParams(st, params);
                return st.executeUpdate();
            }
        });
    }

    public int insert(String table, Record record) {
        return insert(table, record, record.getFieldNames());
    }

    public int insert(String table, Record record, List&lt;String&gt; insertFields) {
        String fields = insertFields.stream().collect(Collectors.joining(", "));
        String qMarks = insertFields.stream().map(e -&gt; "?").collect(Collectors.joining(", "));
        String sql = "INSERT INTO " + table + "(" + fields + ") VALUES (" + qMarks + ")";
        List&lt;Object&gt; params = insertFields.stream().map(e -&gt; record.get(e)).collect(Collectors.toList());
        return withConn(conn -&gt; {
            try (PreparedStatement st = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
                setParams(st, params.toArray());
                int uc = st.executeUpdate();
                // Check for auto generated keys, if present add into the record.
                // NOTE it will not override existing fields in record!
                try (ResultSet rs = st.getGeneratedKeys()) {
                    if (rs.next()) {
                        List&lt;String&gt; names = getFieldNames(rs);
                        for (String name : names) {
                            if (!record.containsKey(name))
                                record.put(name, rs.getObject(name));
                        }
                    }
                }
                return uc;
            }
        });
    }

    public int update(String table, Record record, String ... keyFields) {
        List&lt;String&gt; updateFields = record.getFieldNames();
        for (String key : keyFields)
            updateFields.remove(key);
        return update(table, record, updateFields, Arrays.asList(keyFields));
    }

    public int update(String table, Record record, List&lt;String&gt; updateFields, List&lt;String&gt; keyFields) {
        String updateFieldsNames = updateFields.stream().map(e -&gt; e + " = ?").collect(Collectors.joining(", "));
        String keyFieldsNames = keyFields.stream().map(e -&gt; e + " = ?").collect(Collectors.joining(", "));
        String sql = "UPDATE " + table + " SET " + updateFieldsNames + " WHERE " + keyFieldsNames;
        List&lt;Object&gt; params = updateFields.stream().map(e -&gt; record.get(e)).collect(Collectors.toList());
        for (String key : keyFields)
            params.add(record.get(key));
        return execute(sql, params.toArray());
    }

    // Test Jdbc with Postgres DB
    public static void main(String[] args) {
        String url = System.getProperty("url", "jdbc:postgresql://localhost:5432/postgres");
        String user = System.getProperty("user", "postgres");
        String password = System.getProperty("password", "");

        Jdbc.withJdbc(url, user, password, jdbc -&gt; {
            jdbc.withConnNoRet(conn -&gt; System.out.println(conn));
        });

        Jdbc.withJdbc(url, user, password, jdbc -&gt; {
            // Execute
            jdbc.execute("create temp table test(id varchar(10) primary key, seq serial, amount numeric(19,4))");
            int uc = jdbc.execute("insert into test(id, amount) values(?, ?)", "T01", 0.01);
            System.out.println("test record inserted: uc=" + uc);

            Record record = jdbc.getRecord("select * from test where id = ?", "T01");
            System.out.println(record);

            // Get
            Integer seq = jdbc.get("select seq from test where id = ?", "T01");
            System.out.println("seq = " + seq);

            java.math.BigDecimal amount = jdbc.get("select amount from test where id = ?", "T01");
            System.out.println("amount = " + amount);

            // Update
            record.put("amount", amount.doubleValue() + 0.20);
            System.out.println("amount to be updated: " + record.getValue("amount"));
            uc = jdbc.update("test", record, "id");
            System.out.println("amount udpated. uc=" + uc);

            amount = jdbc.get("select amount from test where id = ?", "T01");
            System.out.println("after update from db: amount = " + amount);

            // Insert
            record = new Record("id", "T02", "amount", 0.30);
            jdbc.insert("test", record);
            int newSeq = (Integer) record.get("seq");
            System.out.println("generated column seq=" + newSeq);
            Record record2 = jdbc.getRecord("select * from test where id = ?", "T02");
            System.out.println(record2);

            // Query
            List&lt;Record&gt; records = jdbc.query("select * from test order by id");
            System.out.println(records);
        });
    }
}
</code></pre></div></div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://localhost:4000/page4">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://localhost:4000/page2">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
