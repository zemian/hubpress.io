<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Zemian's Blog &middot; Life in programming world!
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/page7/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-135626598-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A weblog on software development.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2020. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Zemian's Blog</a>
            <small>Life in programming world!</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/03/03/git-clone-failed-with-ssl-certificate-problem/">
        Git clone failed with SSL certificate problem
      </a>
    </h1>

    <span class="post-date">03 Mar 2018</span>

    <p>Problem:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/notepad-plus-plus/notepad-plus-plus
Cloning into 'notepad-plus-plus'...
fatal: unable to access 'https://github.com/notepad-plus-plus/notepad-plus-plus/': SSL certificate problem: unable to get local issuer certificate
</code></pre></div></div>

<p>Solution:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global http.sslVerify false
# then retry above command
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/28/how-to-find-httpd-config-file-location/">
        How to find httpd config file location
      </a>
    </h1>

    <span class="post-date">28 Feb 2018</span>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Zemians-MacBook-Air:~ zemian$ httpd -t -D DUMP_INCLUDES
Included configuration files:
  (*) /private/etc/apache2/httpd.conf
    (498) /private/etc/apache2/extra/httpd-mpm.conf
    (504) /private/etc/apache2/extra/httpd-autoindex.conf
    (544) /private/etc/apache2/other/php7.conf
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/27/how-to-setup-httpd-form-authentication-and-user-session-loginlogout/">
        How to setup httpd form authentication and user session login/logout
      </a>
    </h1>

    <span class="post-date">27 Feb 2018</span>

    <h2 id="configuration-setup-for-httpdconf">Configuration setup for <code class="language-plaintext highlighter-rouge">httpd.conf</code></h2>

<p>Enable modules</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadModule auth_form_module modules/mod_auth_form.so
LoadModule auth_digest_module modules/mod_auth_digest.so
LoadModule session_module modules/mod_session.so
LoadModule session_cookie_module modules/mod_session_cookie.so
</code></pre></div></div>

<p>NOTE: This configuration is only for tutorial purpose and not secured by default! Using Cookies session store is NOT secured! It’s recommend you use <code class="language-plaintext highlighter-rouge">mod_session_crypto</code> to further secure data, or use server side session data store.</p>

<p>Setup users</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># First user and new file
htpasswd -c /etc/httpd/passwd/passwords test
# Update/add more user
htpasswd /etc/httpd/passwd/passwords zemian
</code></pre></div></div>

<p>NOTE: You need <code class="language-plaintext highlighter-rouge">httpd-tool</code> package from Cygwin to find <code class="language-plaintext highlighter-rouge">htpasswd</code> command.</p>

<p>Example of Digest login</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Digest Login
&lt;Location "/secured"&gt;
	AuthType Basic
	AuthName "Restricted Files"
	AuthBasicProvider file
	AuthUserFile "/etc/httpd/passwd/passwords"
	Require valid-user
&lt;/Location&gt;
</code></pre></div></div>

<p>Example of form login</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Form Login/logout process
&lt;LocationMatch "(/secured|/cgi-bin/secured)"&gt;
	Require valid-user
	AuthName "SecuredArea"
	AuthFormProvider file
	AuthUserFile "/etc/httpd/passwd/passwords"
    AuthType form
	AuthFormLoginRequiredLocation "/login.html"
	
	Session On
	SessionCookieName session path=/
	SessionMaxAge 30
	SessionEnv On
	SessionHeader X-Replace-Session
&lt;/LocationMatch&gt;
&lt;Location "/login"&gt;
	SetHandler form-login-handler
	AuthName "SecuredArea"
	AuthFormProvider file
	AuthUserFile "/etc/httpd/passwd/passwords"
    AuthType form
	AuthFormLoginRequiredLocation "/login.html"
    AuthFormLoginSuccessLocation "/secured/index.html"
		
	Session On
	SessionCookieName session path=/
&lt;/Location&gt;
&lt;Location "/logout"&gt;
	SetHandler form-logout-handler
	AuthName "SecuredArea"
	AuthFormLogoutLocation "http://localhost/logout.html"
	
	Session On
	SessionCookieName session path=/
	SessionMaxAge 1
&lt;/Location&gt;
</code></pre></div></div>

<p>Login page <code class="language-plaintext highlighter-rouge">htdocs/login.html</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;form method="POST" action="/login"&gt;
  Username: &lt;input type="text" name="httpd_username" value="" /&gt;
  Password: &lt;input type="password" name="httpd_password" value="" /&gt;
  &lt;input type="submit" name="login" value="Login" /&gt;
&lt;/form&gt;
</code></pre></div></div>

<p>Logout page <code class="language-plaintext highlighter-rouge">htdocs/logout.html</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt;You have been logged out.&lt;/p&gt;
</code></pre></div></div>

<p>Secured page <code class="language-plaintext highlighter-rouge">htdocs/secured/index.html</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;p&gt;This is secured area&lt;/p&gt;
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/27/getting-started-with-apache-httpd-web-server-on-windows/">
        Getting started with Apache HTTPD Web Server on Windows
      </a>
    </h1>

    <span class="post-date">27 Feb 2018</span>

    <h1 id="using-native-windows-binary-without-admin-rights">Using native Windows Binary (without admin rights)</h1>

<ol>
  <li>
    <p>Download one of binary from
<a href="https://httpd.apache.org/docs/current/platform/windows.html#down">https://httpd.apache.org/docs/current/platform/windows.html#down</a></p>
  </li>
  <li>
    <p>Unzip a portable version (zip file) into <code class="language-plaintext highlighter-rouge">C:\Apache24</code></p>
  </li>
  <li>
    <p>cd <code class="language-plaintext highlighter-rouge">C:\Apache24\bin</code> and run httpd.exe</p>
  </li>
  <li>
    <p>Open browser to <a href="http://localhost">http://localhost</a></p>
  </li>
</ol>

<p>Press <code class="language-plaintext highlighter-rouge">CTRL+C</code> to stop the server.</p>

<h2 id="where-is-the-httpdconf">Where is the <code class="language-plaintext highlighter-rouge">httpd.conf</code>?</h2>

<p>The web server config file is located at <code class="language-plaintext highlighter-rouge">C:\Apache24\conf\httpd.conf</code></p>

<p>The default document root should be at <code class="language-plaintext highlighter-rouge">C:\Apache24\htdocs</code></p>

<p>The default error log file is at <code class="language-plaintext highlighter-rouge">C:\Apache24\logs\error.log</code></p>

<h2 id="how-to-enable-cgi-bin-scripts">How to enable cgi-bin scripts</h2>

<p>There is a default <code class="language-plaintext highlighter-rouge">perl</code> test script under
<code class="language-plaintext highlighter-rouge">C:\Apache24\cgi-bin\printenv.pl</code>, and if you have native Windows Perl
installed, you need to modify the first line in the script. Example:
<code class="language-plaintext highlighter-rouge">#!/C:/perl5/perl.exe</code></p>

<p>Now test it on <a href="http://localhost/cgi-bin/printenv.pl">http://localhost/cgi-bin/printenv.pl</a></p>

<h2 id="using-python-as-cgi-bin-test-script">Using Python as <code class="language-plaintext highlighter-rouge">cgi-bin</code> test script</h2>

<p>Create <code class="language-plaintext highlighter-rouge">C:\Apache24\cgi-bin\printenv.py</code> script:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!C:/Python36/python.exe
import cgi
cgi.test()
</code></pre></div></div>

<p>Test it on <a href="http://localhost/cgi-bin/printenv.py">http://localhost/cgi-bin/printenv.py</a></p>

<h1 id="using-cygwin-for-windows">Using Cygwin for Windows</h1>

<ol>
  <li>
    <p>Install <code class="language-plaintext highlighter-rouge">httpd</code> and <code class="language-plaintext highlighter-rouge">httpd-tool</code> packages in your cygwin</p>
  </li>
  <li>
    <p>If you have not started <code class="language-plaintext highlighter-rouge">cygserver</code>, run it now in the background.</p>
  </li>
  <li>
    <p>Run <code class="language-plaintext highlighter-rouge">apachectl -k start</code></p>
  </li>
  <li>
    <p>Open browser to <a href="http://localhost">http://localhost</a></p>
  </li>
</ol>

<p>Run <code class="language-plaintext highlighter-rouge">apachectl -k stop</code> to stop the server.</p>

<h2 id="where-is-the-httpdconf-">Where is the <code class="language-plaintext highlighter-rouge">httpd.conf</code> ?</h2>

<p>The web server config file is located at <code class="language-plaintext highlighter-rouge">/etc/httpd/conf/httpd.conf</code></p>

<p>The default document root should be at <code class="language-plaintext highlighter-rouge">/srv/www/htdocs</code></p>

<p>The default error log file is at <code class="language-plaintext highlighter-rouge">/var/log/httpd/error_log</code></p>

<h2 id="how-to-enable-cgi-bin-scripts-1">How to enable cgi-bin scripts</h2>

<ol>
  <li>
    <p>Ensure you have installed <code class="language-plaintext highlighter-rouge">perl</code> package in Cygwin.</p>
  </li>
  <li>
    <p>Modify <code class="language-plaintext highlighter-rouge">/srv/www/cgi-bin/printenv</code> file first line with
<code class="language-plaintext highlighter-rouge">#!/usr/bin/perl</code></p>
  </li>
  <li>
    <p>Run <code class="language-plaintext highlighter-rouge">chmod a+x</code></p>
  </li>
  <li>Modify <code class="language-plaintext highlighter-rouge">httpd.conf</code> to enable <code class="language-plaintext highlighter-rouge">mod_cgi</code>:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;IfModule mpm_prefork_module&gt;
            LoadModule cgi_module modules/mod_cgi.so
    &lt;/IfModule&gt;
</code></pre></div>    </div>
  </li>
  <li>Restart httpd server</li>
</ol>

<p>Now test it on <a href="http://localhost/cgi-bin/printenv">http://localhost/cgi-bin/printenv</a></p>

<p>You can also test the <code class="language-plaintext highlighter-rouge">/srv/www/cgi-bin/test-cgi</code> script, but it uses
<code class="language-plaintext highlighter-rouge">#!/usr/bin/sh</code> instead of <code class="language-plaintext highlighter-rouge">perl</code>!</p>

<p>If you use default <code class="language-plaintext highlighter-rouge">cgi-bin</code> folder that are setup with <code class="language-plaintext highlighter-rouge">ScriptAlias</code>,
then you do not need to add <code class="language-plaintext highlighter-rouge">Options +ExecCGI</code> line to the conf file.</p>

<h2 id="using-python-as-cgi-bin-test-script-1">Using Python as <code class="language-plaintext highlighter-rouge">cgi-bin</code> test script</h2>

<p>Create <code class="language-plaintext highlighter-rouge">/srv/www/cgi-bin/printenv.py</code> script:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    #!/usr/bin/python3
    import cgi
    cgi.test()
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/26/customizing-httpd-conf-with-special-request-header-and-filter/">
        Customizing httpd conf with special request header and filter
      </a>
    </h1>

    <span class="post-date">26 Feb 2018</span>

    <h2 id="how-to-setup-httpd-reverse-proxy-for-tomcat">How to setup httpd reverse proxy for Tomcat</h2>

<p>Enable modules</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	# NOTE: If you are using Cygwin, these module requires cygserver to run!
	#       else you get the following error:
	#
	#[Mon Feb 26 09:26:50.308620 2018] [proxy:crit] [pid 7564] (88)Function not implemented: AH02478: #failed to create proxy mutex
	#AH00016: Configuration Failed
	#
	LoadModule proxy_module modules/mod_proxy.so
	LoadModule proxy_http_module modules/mod_proxy_http.so
</code></pre></div></div>

<p>Setup reverse proxy</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	# Reverse Proxy Setup
	# NOTE: The ending slash '/' is important!
	&lt;IfModule proxy_module&gt;
	ProxyPass "/"  "http://localhost:8080/"
	ProxyPassReverse "/"  "http://localhost/"
	&lt;/IfModule&gt;
</code></pre></div></div>

<h2 id="how-to-add-custom-headers-to-requests">How to add custom headers to requests</h2>

<p>Enable modules</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadModule headers_module modules/mod_headers.so
</code></pre></div></div>

<p>Add headers to all requests</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Location "/"&gt;
	# Add custom headers
	RequestHeader set appuser "test"
	# Or add custom headers based on env variables exist
	RequestHeader set appuser2 "%{APPUSER}e" env=APPUSER
&lt;/Location&gt;
</code></pre></div></div>

<h2 id="how-to-setup-httpd-filter">How to setup Httpd Filter</h2>

<p>Enable modules</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LoadModule ext_filter_module modules/mod_ext_filter.so
LoadModule request_module modules/mod_request.so
</code></pre></div></div>

<p>Windows Example</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	# Setup external script to run request filter
	ExtFilterDefine my-filter mode=input \
		cmd="C:/Python36/pythonw.exe C:/Apache24/cgi-bin/my-filter.py"
	&lt;Directory  "cgi-bin"&gt;
		SetInputFilter my-filter
	&lt;/Directory&gt;
</code></pre></div></div>

<p>Cygwin Example</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	# Setup external script to run request filter
	ExtFilterDefine my-filter mode=input \
		cmd="/usr/bin/python3 /srv/www/cgi-bin/my-filter/my-filter.py"
	&lt;Directory  "/srv/www/cgi-bin/my-filter"&gt;
		SetInputFilter my-filter
	&lt;/Directory&gt;
</code></pre></div></div>

<p>File my-filter.py</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	#!/usr/bin/python3
	import datetime
	log = '/var/log/httpd/my-filter.log'
	with open(log, 'a') as file:
		file.write(f'{datetime.datetime.now()} hello filter\n')
</code></pre></div></div>

<p>File my-filter2.py</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	#!/usr/bin/python3
	import datetime, sys, os
	log = '/var/log/httpd/my-filter.log'
	with open(log, 'a') as file:
		file.write(f'## {datetime.datetime.now()} hello filter\n')
		file.write(f'arguments: {sys.argv}\n')
		file.write(f'STDOIUT:\n')
		for line in sys.stdin:
			file.write(f'{line}\n')
		file.write(f'os.environments:\n')
		for k,v in os.environ.items():
				file.write(f'os.env: {k} = {v}\n')
</code></pre></div></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/23/how-to-turn-off-intellij-autoformat-on-a-block-of-code/">
        How to turn off IntelliJ autoformat on a block of code
      </a>
    </h1>

    <span class="post-date">23 Feb 2018</span>

    <p>When doing bug fix on old codes, you want least possible change set as
possible. The IntelliJ IDE by default will auto reformat your code upon
a <code class="language-plaintext highlighter-rouge">}</code> character you type. (Example: when you add a try/finally block to
an existing block of code, then it will reformat that block of code base
on IDE’s Code Style you configured.) If you have legacy code, they’re
most likely formatted differently than your IDE style, and it will make
unnessary changes. This is not what you want during bug fix. So to turn
it off, you can do this:</p>

<p>For, IntelliJ 2017.3, go to Menu
<code class="language-plaintext highlighter-rouge">File &gt; Settings &gt; Editor &gt; General &gt; Smark Keys</code>, then uncheck
<code class="language-plaintext highlighter-rouge">Reformat block  on typing '}'</code> item.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/20/starting-postgres-server-on-cygwin/">
        Starting postgres server on Cygwin
      </a>
    </h1>

    <span class="post-date">20 Feb 2018</span>

    <p>To run postgres database server on Cygwin, you need first run the
<code class="language-plaintext highlighter-rouge">cygserver</code>. If not, you will get error similar to this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PGDATA=/cygdrive/c/Users/zemian/my-pgdata
pg_ctl init
...
running bootstrap script ... FATAL:  could not create shared memory segment: Function not implemented
DETAIL:  Failed system call was shmget(key=1, size=56, 03600).
child process exited with exit code 1
initdb: removing contents of data directory "/cygdrive/c/Users/zemian/my-pgdata"
pg_ctl: database system initialization failed
</code></pre></div></div>

<p>To resolve this, you first start <code class="language-plaintext highlighter-rouge">cygserver</code>. Even if you do not have
admin rights to install as Windows service, you can still run it per
shell session. This is needed for <strong>shared memory</strong> need.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># For the first time, you need config
/usr/bin/cygserver-config

# Now run it
cygserver &amp;
</code></pre></div></div>

<p>After above then you can start postgres</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_ctrl init
pg_ctrl start
</code></pre></div></div>

<h1 id="postgres-windows-installation">Postgres Windows Installation</h1>

<p>The official download is provided by EnterpriseDB (EDB) You can get a
zip package from:</p>

<p><a href="https://www.enterprisedb.com/download-postgresql-binaries">https://www.enterprisedb.com/download-postgresql-binaries</a></p>

<p>To install, just unzip it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir $HOME/apps/postgresql-10.3-2
cd $HOME/apps/postgresql-10.3-2
unzip postgresql-10.3-2-windows-x64-binaries.zip
</code></pre></div></div>

<p>Server can be started manually like this in cmd.exe prompt:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin\pg_ctl -D data -o "--encoding=UTF8 --auth=trust" initdb
mkdir logs
bin\pg_ctl -D data -l logs\postgres.log start

bin\createdb %USERNAME%
chcp 1252
bin\psql

zemian=# select version();
                          version
------------------------------------------------------------
 PostgreSQL 10.3, compiled by Visual C++ build 1800, 64-bit
(1 row)
</code></pre></div></div>

<p>By default inidb will create a “postgres” database, but user is your
Windows login name, and it will not match. It’s more convient to create
a database that match your username, and use that as default.</p>

<p>You should be careful with “–auth=trust”, which can get you started
quickly but not very secure.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/17/intellij-highlight-out-println-in-jsp-as-red-error/">
        IntelliJ highlight "out.println" in JSP as red error
      </a>
    </h1>

    <span class="post-date">17 Feb 2018</span>

    <p>Some times you might have a Maven web application that deployes without
problem into a Tomcat server, but when open in IntelliJ IDE, you will
notice some of your JSP files have red error marks on lines such as
<code class="language-plaintext highlighter-rouge">out.println("test");</code>. This problem can occur if your project <code class="language-plaintext highlighter-rouge">pom.xml</code>
did not include <code class="language-plaintext highlighter-rouge">jsp-api</code> as provided dependency to your project! So
ensure it contains these in your <code class="language-plaintext highlighter-rouge">pom.xml</code> file.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        &lt;!-- Web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet.jsp-api&lt;/artifactId&gt;
            &lt;version&gt;2.3.1&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
            &lt;version&gt;1.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre></div></div>

<p>Note that for Tomcat, you must include the <code class="language-plaintext highlighter-rouge">JSTL</code> tag library as
dependency, and it is NOT provided by server if you want to use the core
JSTL tags!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/02/11/intellij-displays-servers-certificate-is-not-trusted-pop-up/">
        IntelliJ displays Server's Certificate is not trusted pop-up
      </a>
    </h1>

    <span class="post-date">11 Feb 2018</span>

    <p>I get this “Server’s Certificate is not trusted” pop-up window once in a
while when I am in different network. If you know your IDE is already
working fine, then you can get rid of it by go to below location.</p>

<p><code class="language-plaintext highlighter-rouge">File | Settings | Tools | Server Certificates for Windows and Linux</code></p>

<p>Then click on “Accept non-trusted certificates automatically”.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2018/01/27/walk-resource-tree-as-directory-in-classpath/">
        Walk resource tree as directory in classpath
      </a>
    </h1>

    <span class="post-date">27 Jan 2018</span>

    <p>The two most frequent type of classpath URL we get when get it through
<code class="language-plaintext highlighter-rouge">ClassLoader#getResource(resourceName)</code> is either <code class="language-plaintext highlighter-rouge">file</code> or <code class="language-plaintext highlighter-rouge">jar</code>
entries. If we want to walk a resources that are stored in a directory,
then we need to parse these differently. For <code class="language-plaintext highlighter-rouge">file</code>, it’s easy to do
since we have <code class="language-plaintext highlighter-rouge">java.io.File</code>. As for <code class="language-plaintext highlighter-rouge">jar</code>, we would use <code class="language-plaintext highlighter-rouge">JarFile</code>. Here
is a implementation.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public static void walkClasspathResDir(ClassLoader cl, String resDir, ConsumerEx&lt;FileStream&gt; fileConsumer) {
        // NOTE: JarEntry.isDirectory() used below requires input to ends with slash.
        if (!resDir.endsWith("/")) {
            resDir = resDir + "/";
        }

        URL url = cl.getResource(resDir);
        if (url == null) {
            throw new AppException("Resource directory " + resDir + " not found in classpath.");
        } else if ("file".equals(url.getProtocol())) {
            File dir = new File(url.getPath());
            if (!dir.isDirectory()) {
                throw new AppException("Resource is not a directory: " + resDir);
            }
            walkFileDir(dir, fileConsumer);
        } else if ("jar".equals(url.getProtocol())) {
            try {
                JarURLConnection conn = (JarURLConnection) url.openConnection();
                if (!(conn.getJarEntry().isDirectory())) {
                    throw new AppException("Resource is not a directory: " + resDir);
                }
                walkJarEntryDir(conn.getJarFile(), resDir, fileConsumer);
            } catch (Exception e) {
                throw new AppException("Unable to read resource: " + url, e);
            }
        } else {
            throw new AppException("Unsupported protocol " + url.getProtocol() + " for checking resource directory.");
        }
    }

    public static void walkFileDir(File dir, ConsumerEx&lt;FileStream&gt; fileConsumer) {
        try {
            Files.walkFileTree(dir.toPath(), new SimpleFileVisitor&lt;Path&gt;() {
                @Override
                public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {
                    try (FileInputStream stream = new FileInputStream(file.toFile())) {
                        try {
                            String shortPath = file.toFile().getPath().substring(dir.getPath().length());
                            // Always convert path separator to Unix
                            shortPath = FilenameUtils.separatorsToUnix(shortPath);
                            // Remove leading '/' if there is any
                            if (shortPath.startsWith("/")) {
                                shortPath = shortPath.substring(1);
                            }
                            fileConsumer.accept(new FileStream(shortPath, stream));
                        } catch (Exception e) {
                            throw new AppException("Failed to process file: " + file, e);
                        }
                    }
                    return FileVisitResult.CONTINUE;
                }
            });
        } catch (IOException e) {
            throw new AppException("Failed to walk directory: " + dir, e);
        }
    }

    public static void walkJarEntryDir(JarFile jarFile, String entryName, ConsumerEx&lt;FileStream&gt; fileConsumer) {
        try {
            Enumeration&lt;JarEntry&gt; entries = jarFile.entries();
            while (entries.hasMoreElements()) {
                JarEntry jarEntry = entries.nextElement();
                if (jarEntry.getName().startsWith(entryName)) {
                    if (!jarEntry.isDirectory()) {
                        try (InputStream stream = jarFile.getInputStream(jarEntry)) {
                            try {
                                String shortPath = jarEntry.getName().substring(entryName.length());
                                fileConsumer.accept(new FileStream(shortPath, stream));
                            } catch (Exception e) {
                                throw new AppException("Failed to process jar entry: " + jarEntry.getName(), e);
                            }
                        }
                    }
                }
            }
        } catch (IOException e) {
            throw new AppException("Failed to walk jar directory entry: " + entryName, e);
        }
    }
</code></pre></div></div>

<p>Here the <code class="language-plaintext highlighter-rouge">FileStream</code> is just a POJO that holds a resource path name and
the stream that points to it. One tricky part to above code is noted in
comment:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// NOTE: JarEntry.isDirectory() used below requires input to ends with slash.
</code></pre></div></div>

<p>Now, here is how we can use it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        ClassLoader cl = Thread.currentThread().getContextClassLoader();
        walkClasspathResDir(cl, "toolbox/templates/javaapp", (fileStream) -&gt; {
            System.out.println(fileStream.getPath() + " " + fileStream.getStream());
        });
        System.out.println();
</code></pre></div></div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="http://localhost:4000/page8">Older</a>
  
  
    
      <a class="pagination-item newer" href="http://localhost:4000/page6">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
